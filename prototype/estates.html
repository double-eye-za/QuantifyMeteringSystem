<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estate Management - Quantify Metering System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#1A73E8',
                        secondary: '#F9FAFB',
                        neutral: '#212121',
                        success: '#28A745',
                        warning: '#FFC107',
                        error: '#DC3545',
                        info: '#17A2B8'
                    },
                    fontFamily: {
                        'sans': ['Inter', 'Roboto', 'system-ui', '-apple-system', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-200">
    <!-- Main Container -->
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside id="sidebar" class="fixed left-0 top-0 h-full w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 transform -translate-x-full md:translate-x-0 transition-transform duration-300 z-40">
            <!-- Logo -->
            <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
                        <i class="fas fa-bolt text-white"></i>
                    </div>
                    <span class="font-bold text-lg text-gray-900 dark:text-white">Quantify Metering</span>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="p-4 space-y-2">
                <a href="index.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">
                    <i class="fas fa-gauge-high w-5"></i>
                    <span class="text-sm font-medium">Dashboard</span>
                </a>
                <a href="estates.html" class="flex items-center gap-3 px-3 py-2 rounded-lg bg-blue-50 dark:bg-blue-900/20 text-primary">
                    <i class="fas fa-building w-5"></i>
                    <span class="text-sm font-medium">Estates</span>
                </a>
                <a href="units.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">
                    <i class="fas fa-house w-5"></i>
                    <span class="text-sm font-medium">Units</span>
                </a>
                <a href="meters.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">
                    <i class="fas fa-tachometer-alt w-5"></i>
                    <span class="text-sm font-medium">Meters</span>
                </a>
                <a href="billing.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">
                    <i class="fas fa-wallet w-5"></i>
                    <span class="text-sm font-medium">Billing</span>
                </a>
                <a href="reports.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">
                    <i class="fas fa-chart-line w-5"></i>
                    <span class="text-sm font-medium">Reports</span>
                </a>
                <a href="rate-tables-simplified.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">
                    <i class="fas fa-table w-5"></i>
                    <span class="text-sm font-medium">Rate Tables</span>
                </a>
                
                <!-- Administration Section -->
                <div class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 mt-6">Administration</div>
                <a href="users.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 transition-colors">
                    <i class="fas fa-users w-5"></i>
                    <span class="text-sm font-medium">Users</span>
                </a>
                <a href="roles.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 transition-colors">
                    <i class="fas fa-user-shield w-5"></i>
                    <span class="text-sm font-medium">Roles</span>
                </a>
                <a href="settings.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 transition-colors">
                    <i class="fas fa-cog w-5"></i>
                    <span class="text-sm font-medium">Settings</span>
                </a>
                <a href="audit-log.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 transition-colors">
                    <i class="fas fa-clipboard-list w-5"></i>
                    <span class="text-sm font-medium">Audit Log</span>
                </a>
            </nav>

            <!-- User Section -->
            <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200 dark:border-gray-700 space-y-2">
                <a href="profile.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 transition-colors">
                    <i class="fas fa-user w-5"></i>
                    <span class="text-sm font-medium">My Profile</span>
                </a>
                <button onclick="logout()" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 transition-colors">
                    <i class="fas fa-right-from-bracket w-5"></i>
                    <span class="text-sm font-medium">Logout</span>
                </button>
            </div>
        </aside>

        <!-- Mobile Sidebar Overlay -->
        <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden md:hidden" onclick="toggleSidebar()"></div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col md:ml-64">
            <!-- Header -->
            <header class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <!-- Mobile menu button -->
                        <button onclick="toggleSidebar()" class="md:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">
                            <i class="fas fa-bars"></i>
                        </button>
                        
                        <!-- Page Title -->
                        <div>
                            <h1 class="text-xl font-bold text-gray-900 dark:text-white">Estate Management</h1>
                            <nav class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                <a href="index.html" class="hover:text-primary">Home</a>
                                <span class="mx-1">/</span>
                                <span>Estates</span>
                            </nav>
                        </div>
                    </div>

                    <!-- Header Actions -->
                    <div class="flex items-center gap-2">
                        <!-- Theme Toggle -->
                        <button id="themeToggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">
                            <i class="fas fa-moon dark:hidden"></i>
                            <i class="fas fa-sun hidden dark:inline"></i>
                        </button>

                        <!-- Logout -->
                        <button onclick="logout()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">
                            <i class="fas fa-right-from-bracket"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Main Content Area -->
            <main class="flex-1 overflow-y-auto p-6">
                <!-- Stats Overview -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Total Estates</p>
                                <p class="text-2xl font-bold text-gray-900 dark:text-white">2</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">Active</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-building text-primary"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Total Units</p>
                                <p class="text-2xl font-bold text-gray-900 dark:text-white">100</p>
                                <p class="text-xs text-success mt-2">All connected</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 dark:bg-green-900/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-home text-success"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Total Meters</p>
                                <p class="text-2xl font-bold text-gray-900 dark:text-white">304</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">300 unit + 4 bulk</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-tachometer-alt text-purple-600"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">Active DC450s</p>
                                <p class="text-2xl font-bold text-gray-900 dark:text-white">4</p>
                                <p class="text-xs text-success mt-2">All online</p>
                            </div>
                            <div class="w-12 h-12 bg-cyan-100 dark:bg-cyan-900/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-network-wired text-info"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Estates List -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                    <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Residential Estates</h2>
                            <button onclick="showAddEstateModal()" class="px-4 py-2 bg-primary hover:bg-blue-700 text-white rounded-lg text-sm transition-colors">
                                <i class="fas fa-plus mr-2"></i> Add Estate
                            </button>
                        </div>
                    </div>

                    <!-- Estate Cards -->
                    <div class="p-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Estate 1 -->
                        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-6">
                            <div class="flex items-start justify-between mb-4">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Willow Creek Estate</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">123 Main Road, Johannesburg</p>
                                </div>
                                <span class="px-2 py-1 bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-400 text-xs rounded-full">Active</span>
                            </div>

                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">Units</p>
                                    <p class="text-lg font-semibold text-gray-900 dark:text-white">50</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">Total Meters</p>
                                    <p class="text-lg font-semibold text-gray-900 dark:text-white">152</p>
                                </div>
                            </div>

                            <!-- Meter Breakdown -->
                            <div class="bg-gray-50 dark:bg-gray-700/30 rounded-lg p-3 mb-4">
                                <p class="text-xs font-semibold text-gray-700 dark:text-gray-300 mb-2">Meter Configuration</p>
                                <div class="space-y-1">
                                    <div class="flex items-center justify-between text-xs">
                                        <span class="text-gray-600 dark:text-gray-400">
                                            <i class="fas fa-bolt text-yellow-500 mr-1"></i> Electricity Meters
                                        </span>
                                        <span class="font-medium text-gray-900 dark:text-white">50 unit + 1 bulk</span>
                                    </div>
                                    <div class="flex items-center justify-between text-xs">
                                        <span class="text-gray-600 dark:text-gray-400">
                                            <i class="fas fa-tint text-blue-500 mr-1"></i> Water Meters
                                        </span>
                                        <span class="font-medium text-gray-900 dark:text-white">50 unit + 1 bulk</span>
                                    </div>
                                    <div class="flex items-center justify-between text-xs">
                                        <span class="text-gray-600 dark:text-gray-400">
                                            <i class="fas fa-solar-panel text-orange-500 mr-1"></i> Solar Meters
                                        </span>
                                        <span class="font-medium text-gray-900 dark:text-white">50 unit</span>
                                    </div>
                                </div>
                            </div>

                            <!-- DC450 Status -->
                            <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3 mb-4">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <i class="fas fa-network-wired text-primary"></i>
                                        <div>
                                            <p class="text-xs font-medium text-blue-900 dark:text-blue-300">DC450 Data Concentrators</p>
                                            <p class="text-xs text-blue-700 dark:text-blue-400">2 units deployed</p>
                                        </div>
                                    </div>
                                    <span class="flex items-center text-xs text-success">
                                        <i class="fas fa-circle mr-1" style="font-size: 8px;"></i> Online
                                    </span>
                                </div>
                            </div>

                            <!-- Contact Info -->
                            <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-xs text-gray-500 dark:text-gray-400">Manager:</span>
                                    <span class="text-xs font-medium text-gray-900 dark:text-white">John Smith</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-xs text-gray-500 dark:text-gray-400">Contact:</span>
                                    <span class="text-xs font-medium text-gray-900 dark:text-white">+27 11 123 4567</span>
                                </div>
                            </div>

                            <!-- Actions -->
                            <div class="flex items-center gap-2 mt-4">
                                <button onclick="viewEstateDetails()" class="flex-1 px-3 py-2 bg-primary hover:bg-blue-700 text-white text-sm rounded-lg transition-colors">
                                    <i class="fas fa-eye mr-1"></i> View Details
                                </button>
                                <button onclick="editEstate()" class="px-3 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 text-sm rounded-lg transition-colors">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Estate 2 -->
                        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-6">
                            <div class="flex items-start justify-between mb-4">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Parkview Gardens</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">456 Park Avenue, Pretoria</p>
                                </div>
                                <span class="px-2 py-1 bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-400 text-xs rounded-full">Active</span>
                            </div>

                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">Units</p>
                                    <p class="text-lg font-semibold text-gray-900 dark:text-white">50</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">Total Meters</p>
                                    <p class="text-lg font-semibold text-gray-900 dark:text-white">152</p>
                                </div>
                            </div>

                            <!-- Meter Breakdown -->
                            <div class="bg-gray-50 dark:bg-gray-700/30 rounded-lg p-3 mb-4">
                                <p class="text-xs font-semibold text-gray-700 dark:text-gray-300 mb-2">Meter Configuration</p>
                                <div class="space-y-1">
                                    <div class="flex items-center justify-between text-xs">
                                        <span class="text-gray-600 dark:text-gray-400">
                                            <i class="fas fa-bolt text-yellow-500 mr-1"></i> Electricity Meters
                                        </span>
                                        <span class="font-medium text-gray-900 dark:text-white">50 unit + 1 bulk</span>
                                    </div>
                                    <div class="flex items-center justify-between text-xs">
                                        <span class="text-gray-600 dark:text-gray-400">
                                            <i class="fas fa-tint text-blue-500 mr-1"></i> Water Meters
                                        </span>
                                        <span class="font-medium text-gray-900 dark:text-white">50 unit + 1 bulk</span>
                                    </div>
                                    <div class="flex items-center justify-between text-xs">
                                        <span class="text-gray-600 dark:text-gray-400">
                                            <i class="fas fa-solar-panel text-orange-500 mr-1"></i> Solar Meters
                                        </span>
                                        <span class="font-medium text-gray-900 dark:text-white">50 unit</span>
                                    </div>
                                </div>
                            </div>

                            <!-- DC450 Status -->
                            <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3 mb-4">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <i class="fas fa-network-wired text-primary"></i>
                                        <div>
                                            <p class="text-xs font-medium text-blue-900 dark:text-blue-300">DC450 Data Concentrators</p>
                                            <p class="text-xs text-blue-700 dark:text-blue-400">2 units deployed</p>
                                        </div>
                                    </div>
                                    <span class="flex items-center text-xs text-success">
                                        <i class="fas fa-circle mr-1" style="font-size: 8px;"></i> Online
                                    </span>
                                </div>
                            </div>

                            <!-- Contact Info -->
                            <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-xs text-gray-500 dark:text-gray-400">Manager:</span>
                                    <span class="text-xs font-medium text-gray-900 dark:text-white">Jane Doe</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-xs text-gray-500 dark:text-gray-400">Contact:</span>
                                    <span class="text-xs font-medium text-gray-900 dark:text-white">+27 12 345 6789</span>
                                </div>
                            </div>

                            <!-- Actions -->
                            <div class="flex items-center gap-2 mt-4">
                                <button onclick="viewEstateDetails()" class="flex-1 px-3 py-2 bg-primary hover:bg-blue-700 text-white text-sm rounded-lg transition-colors">
                                    <i class="fas fa-eye mr-1"></i> View Details
                                </button>
                                <button onclick="editEstate()" class="px-3 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 text-sm rounded-lg transition-colors">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bulk Meter Summary -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 mt-6">
                    <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                        <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Bulk Meter Overview</h2>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Total complex consumption monitoring</p>
                    </div>
                    <div class="p-6">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50 dark:bg-gray-700 text-xs">
                                    <tr>
                                        <th class="px-4 py-3 text-left font-medium text-gray-700 dark:text-gray-300">Estate</th>
                                        <th class="px-4 py-3 text-left font-medium text-gray-700 dark:text-gray-300">Meter Type</th>
                                        <th class="px-4 py-3 text-left font-medium text-gray-700 dark:text-gray-300">Meter ID</th>
                                        <th class="px-4 py-3 text-left font-medium text-gray-700 dark:text-gray-300">Current Reading</th>
                                        <th class="px-4 py-3 text-left font-medium text-gray-700 dark:text-gray-300">Status</th>
                                        <th class="px-4 py-3 text-left font-medium text-gray-700 dark:text-gray-300">Last Update</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                        <td class="px-4 py-3 text-sm text-gray-900 dark:text-gray-300">Willow Creek</td>
                                        <td class="px-4 py-3 text-sm">
                                            <span class="flex items-center gap-1">
                                                <i class="fas fa-bolt text-yellow-500"></i>
                                                <span class="text-gray-900 dark:text-gray-300">Electricity</span>
                                            </span>
                                        </td>
                                        <td class="px-4 py-3 text-sm font-mono text-gray-900 dark:text-gray-300">BLK-E-001</td>
                                        <td class="px-4 py-3 text-sm font-medium text-gray-900 dark:text-white">45,678 kWh</td>
                                        <td class="px-4 py-3">
                                            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-400">
                                                Online
                                            </span>
                                        </td>
                                        <td class="px-4 py-3 text-xs text-gray-500 dark:text-gray-400">2 min ago</td>
                                    </tr>
                                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                        <td class="px-4 py-3 text-sm text-gray-900 dark:text-gray-300">Willow Creek</td>
                                        <td class="px-4 py-3 text-sm">
                                            <span class="flex items-center gap-1">
                                                <i class="fas fa-tint text-blue-500"></i>
                                                <span class="text-gray-900 dark:text-gray-300">Water</span>
                                            </span>
                                        </td>
                                        <td class="px-4 py-3 text-sm font-mono text-gray-900 dark:text-gray-300">BLK-W-001</td>
                                        <td class="px-4 py-3 text-sm font-medium text-gray-900 dark:text-white">12,345 kL</td>
                                        <td class="px-4 py-3">
                                            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-400">
                                                Online
                                            </span>
                                        </td>
                                        <td class="px-4 py-3 text-xs text-gray-500 dark:text-gray-400">1 min ago</td>
                                    </tr>
                                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                        <td class="px-4 py-3 text-sm text-gray-900 dark:text-gray-300">Parkview Gardens</td>
                                        <td class="px-4 py-3 text-sm">
                                            <span class="flex items-center gap-1">
                                                <i class="fas fa-bolt text-yellow-500"></i>
                                                <span class="text-gray-900 dark:text-gray-300">Electricity</span>
                                            </span>
                                        </td>
                                        <td class="px-4 py-3 text-sm font-mono text-gray-900 dark:text-gray-300">BLK-E-002</td>
                                        <td class="px-4 py-3 text-sm font-medium text-gray-900 dark:text-white">52,890 kWh</td>
                                        <td class="px-4 py-3">
                                            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-400">
                                                Online
                                            </span>
                                        </td>
                                        <td class="px-4 py-3 text-xs text-gray-500 dark:text-gray-400">3 min ago</td>
                                    </tr>
                                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                        <td class="px-4 py-3 text-sm text-gray-900 dark:text-gray-300">Parkview Gardens</td>
                                        <td class="px-4 py-3 text-sm">
                                            <span class="flex items-center gap-1">
                                                <i class="fas fa-tint text-blue-500"></i>
                                                <span class="text-gray-900 dark:text-gray-300">Water</span>
                                            </span>
                                        </td>
                                        <td class="px-4 py-3 text-sm font-mono text-gray-900 dark:text-gray-300">BLK-W-002</td>
                                        <td class="px-4 py-3 text-sm font-medium text-gray-900 dark:text-white">14,567 kL</td>
                                        <td class="px-4 py-3">
                                            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-400">
                                                Online
                                            </span>
                                        </td>
                                        <td class="px-4 py-3 text-xs text-gray-500 dark:text-gray-400">2 min ago</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Bulk Meter vs Unit Usage Reconciliation Section -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 mt-6">
                    <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-3 sm:mb-0">
                                <i class="fas fa-balance-scale text-blue-500 mr-2"></i>
                                Bulk Meter vs Unit Usage Reconciliation
                            </h2>
                            <div class="flex flex-wrap gap-2">
                                <!-- Estate Selector -->
                                <select id="estateSelect" onchange="updateReconciliation()" class="px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700">
                                    <option value="willow">Willow Creek Estate</option>
                                    <option value="parkview">Parkview Gardens</option>
                                </select>
                                
                                <!-- View Type -->
                                <select id="viewType" onchange="updateReconciliation()" class="px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700">
                                    <option value="mtd">Month to Date</option>
                                    <option value="monthly">Monthly Comparison</option>
                                    <option value="yearly">Year Overview</option>
                                </select>
                                
                                <!-- Export Button -->
                                <button onclick="exportData()" class="px-3 py-1.5 text-sm bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                                    <i class="fas fa-download mr-1"></i>Export
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Month to Date View -->
                    <div id="mtdView" class="p-6">
                        <div class="mb-4">
                            <h3 class="text-md font-semibold text-gray-900 dark:text-white mb-2">October 2025 - Month to Date</h3>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- Summary Card -->
                                <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                                    <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Current Month Summary</h4>
                                    <div class="space-y-2">
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Days Elapsed</span>
                                            <span class="text-sm font-semibold">9 of 31</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Total Bulk Reading</span>
                                            <span class="text-sm font-semibold">5,625 kWh</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Solar Offset</span>
                                            <span class="text-sm font-semibold text-yellow-600">-1,350 kWh</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Units Total</span>
                                            <span class="text-sm font-semibold">4,212 kWh</span>
                                        </div>
                                        <div class="flex justify-between items-center pt-2 border-t">
                                            <span class="text-sm font-medium text-red-700 dark:text-red-300">Unaccounted</span>
                                            <span class="text-sm font-bold text-red-600">63 kWh (1.5%)</span>
                                        </div>
                                        <div class="flex justify-between items-center bg-yellow-50 dark:bg-yellow-900/20 -mx-2 px-2 py-2 rounded">
                                            <span class="text-sm font-medium text-yellow-700 dark:text-yellow-300">Estate Bill MTD</span>
                                            <span class="text-sm font-bold text-yellow-600">R 157.50</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Daily Trend Chart -->
                                <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                                    <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Daily Loss Trend</h4>
                                    <div class="relative h-64">
                                        <canvas id="dailyTrendChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Detailed Daily Breakdown -->
                        <div class="mt-6 overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                                    <tr>
                                        <th class="px-4 py-3 text-left">Date</th>
                                        <th class="px-4 py-3 text-center">Bulk (kWh)</th>
                                        <th class="px-4 py-3 text-center">Solar (kWh)</th>
                                        <th class="px-4 py-3 text-center">Net (kWh)</th>
                                        <th class="px-4 py-3 text-center">Units (kWh)</th>
                                        <th class="px-4 py-3 text-center">Loss (kWh)</th>
                                        <th class="px-4 py-3 text-center">Loss %</th>
                                        <th class="px-4 py-3 text-right">Daily Bill</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                        <td class="px-4 py-3">Oct 1</td>
                                        <td class="px-4 py-3 text-center">625</td>
                                        <td class="px-4 py-3 text-center">150</td>
                                        <td class="px-4 py-3 text-center">475</td>
                                        <td class="px-4 py-3 text-center">468</td>
                                        <td class="px-4 py-3 text-center text-red-600">7</td>
                                        <td class="px-4 py-3 text-center">1.5%</td>
                                        <td class="px-4 py-3 text-right font-semibold">R 17.50</td>
                                    </tr>
                                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                        <td class="px-4 py-3">Oct 2</td>
                                        <td class="px-4 py-3 text-center">642</td>
                                        <td class="px-4 py-3 text-center">148</td>
                                        <td class="px-4 py-3 text-center">494</td>
                                        <td class="px-4 py-3 text-center">485</td>
                                        <td class="px-4 py-3 text-center text-red-600">9</td>
                                        <td class="px-4 py-3 text-center">1.8%</td>
                                        <td class="px-4 py-3 text-right font-semibold">R 22.50</td>
                                    </tr>
                                    <!-- More daily rows... -->
                                    <tr class="bg-gray-100 dark:bg-gray-700 font-semibold">
                                        <td class="px-4 py-3">MTD Total</td>
                                        <td class="px-4 py-3 text-center">5,625</td>
                                        <td class="px-4 py-3 text-center">1,350</td>
                                        <td class="px-4 py-3 text-center">4,275</td>
                                        <td class="px-4 py-3 text-center">4,212</td>
                                        <td class="px-4 py-3 text-center text-red-600">63</td>
                                        <td class="px-4 py-3 text-center">1.5%</td>
                                        <td class="px-4 py-3 text-right text-lg">R 157.50</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Monthly Comparison View (Hidden by default) -->
                    <div id="monthlyView" class="p-6 hidden">
                        <div class="mb-4">
                            <h3 class="text-md font-semibold text-gray-900 dark:text-white mb-4">Monthly Comparison - 2025</h3>
                            
                            <!-- Monthly Chart -->
                            <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 mb-6">
                                <div class="relative h-80">
                                    <canvas id="monthlyChart"></canvas>
                                </div>
                            </div>

                            <!-- Monthly Table -->
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                                        <tr>
                                            <th class="px-4 py-3 text-left">Month</th>
                                            <th class="px-4 py-3 text-center">Bulk (kWh)</th>
                                            <th class="px-4 py-3 text-center">Solar (kWh)</th>
                                            <th class="px-4 py-3 text-center">Net (kWh)</th>
                                            <th class="px-4 py-3 text-center">Units (kWh)</th>
                                            <th class="px-4 py-3 text-center">Loss (kWh)</th>
                                            <th class="px-4 py-3 text-center">Loss %</th>
                                            <th class="px-4 py-3 text-center">Efficiency</th>
                                            <th class="px-4 py-3 text-right">Estate Bill</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                            <td class="px-4 py-3 font-medium">January</td>
                                            <td class="px-4 py-3 text-center">18,750</td>
                                            <td class="px-4 py-3 text-center">4,650</td>
                                            <td class="px-4 py-3 text-center">14,100</td>
                                            <td class="px-4 py-3 text-center">13,886</td>
                                            <td class="px-4 py-3 text-center text-red-600">214</td>
                                            <td class="px-4 py-3 text-center">1.5%</td>
                                            <td class="px-4 py-3 text-center">
                                                <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded">98.5%</span>
                                            </td>
                                            <td class="px-4 py-3 text-right font-semibold">R 535.00</td>
                                        </tr>
                                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                            <td class="px-4 py-3 font-medium">February</td>
                                            <td class="px-4 py-3 text-center">16,800</td>
                                            <td class="px-4 py-3 text-center">4,200</td>
                                            <td class="px-4 py-3 text-center">12,600</td>
                                            <td class="px-4 py-3 text-center">12,411</td>
                                            <td class="px-4 py-3 text-center text-red-600">189</td>
                                            <td class="px-4 py-3 text-center">1.5%</td>
                                            <td class="px-4 py-3 text-center">
                                                <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded">98.5%</span>
                                            </td>
                                            <td class="px-4 py-3 text-right font-semibold">R 472.50</td>
                                        </tr>
                                        <!-- More months... -->
                                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50 text-gray-500">
                                            <td class="px-4 py-3 font-medium">October (MTD)</td>
                                            <td class="px-4 py-3 text-center">5,625</td>
                                            <td class="px-4 py-3 text-center">1,350</td>
                                            <td class="px-4 py-3 text-center">4,275</td>
                                            <td class="px-4 py-3 text-center">4,212</td>
                                            <td class="px-4 py-3 text-center text-red-600">63</td>
                                            <td class="px-4 py-3 text-center">1.5%</td>
                                            <td class="px-4 py-3 text-center">
                                                <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded">98.5%</span>
                                            </td>
                                            <td class="px-4 py-3 text-right font-semibold">R 157.50</td>
                                        </tr>
                                        <!-- Year Total -->
                                        <tr class="bg-gray-100 dark:bg-gray-700 font-bold">
                                            <td class="px-4 py-3">YTD Total</td>
                                            <td class="px-4 py-3 text-center">162,375</td>
                                            <td class="px-4 py-3 text-center">39,150</td>
                                            <td class="px-4 py-3 text-center">123,225</td>
                                            <td class="px-4 py-3 text-center">121,287</td>
                                            <td class="px-4 py-3 text-center text-red-600">1,938</td>
                                            <td class="px-4 py-3 text-center">1.6%</td>
                                            <td class="px-4 py-3 text-center">
                                                <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded">98.4%</span>
                                            </td>
                                            <td class="px-4 py-3 text-right text-lg">R 4,845.00</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Key Metrics -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-6">
                                <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3">
                                    <p class="text-xs text-blue-600 dark:text-blue-400">Avg Monthly Loss</p>
                                    <p class="text-xl font-bold text-blue-800 dark:text-blue-200">194 kWh</p>
                                    <p class="text-xs text-blue-600 dark:text-blue-400">1.6% average</p>
                                </div>
                                <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-3">
                                    <p class="text-xs text-green-600 dark:text-green-400">Best Month</p>
                                    <p class="text-xl font-bold text-green-800 dark:text-green-200">March</p>
                                    <p class="text-xs text-green-600 dark:text-green-400">1.2% loss</p>
                                </div>
                                <div class="bg-red-50 dark:bg-red-900/20 rounded-lg p-3">
                                    <p class="text-xs text-red-600 dark:text-red-400">Worst Month</p>
                                    <p class="text-xl font-bold text-red-800 dark:text-red-200">July</p>
                                    <p class="text-xs text-red-600 dark:text-red-400">2.1% loss</p>
                                </div>
                                <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-3">
                                    <p class="text-xs text-yellow-600 dark:text-yellow-400">YTD Estate Bill</p>
                                    <p class="text-xl font-bold text-yellow-800 dark:text-yellow-200">R 4,845</p>
                                    <p class="text-xs text-yellow-600 dark:text-yellow-400">All losses</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;

        // Check for saved theme or default to light
        const savedTheme = localStorage.getItem('theme') || 'light';
        if (savedTheme === 'dark') {
            html.classList.add('dark');
        }

        themeToggle.addEventListener('click', () => {
            html.classList.toggle('dark');
            const currentTheme = html.classList.contains('dark') ? 'dark' : 'light';
            localStorage.setItem('theme', currentTheme);
        });

        // Sidebar Toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        }

        // Estate Functions
        function showAddEstateModal() {
            alert('Add Estate modal would open here');
        }

        function viewEstateDetails() {
            window.location.href = 'units.html';
        }

        function editEstate() {
            alert('Edit Estate modal would open here');
        }

        // Logout Function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = 'login.html';
            }
        }

        // Reconciliation View Functions
        function updateReconciliation() {
            const viewType = document.getElementById('viewType').value;
            const estateSelect = document.getElementById('estateSelect').value;
            const mtdView = document.getElementById('mtdView');
            const monthlyView = document.getElementById('monthlyView');
            
            // Hide all views first
            mtdView.classList.add('hidden');
            monthlyView.classList.add('hidden');
            
            // Show selected view
            if (viewType === 'mtd') {
                mtdView.classList.remove('hidden');
                updateMTDData(estateSelect);
            } else if (viewType === 'monthly' || viewType === 'yearly') {
                monthlyView.classList.remove('hidden');
                updateMonthlyData(estateSelect, viewType);
            }
        }

        function updateMTDData(estate) {
            console.log('Updating MTD data for:', estate);
            drawDailyTrendChart();
        }

        function updateMonthlyData(estate, viewType) {
            console.log('Updating monthly data for:', estate, viewType);
            drawMonthlyChart();
        }

        function exportData() {
            const viewType = document.getElementById('viewType').value;
            const estate = document.getElementById('estateSelect').value;
            alert(`Exporting ${viewType} data for ${estate}...`);
        }

        // Chart Drawing Functions
        function drawDailyTrendChart() {
            const canvas = document.getElementById('dailyTrendChart');
            if (canvas && canvas.getContext) {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.beginPath();
                ctx.strokeStyle = '#ef4444';
                ctx.lineWidth = 2;
                
                const data = [7, 9, 6, 8, 5, 7, 8, 6, 7];
                const spacing = canvas.width / (data.length - 1);
                
                data.forEach((value, index) => {
                    const x = index * spacing;
                    const y = canvas.height - (value * 10 + 50);
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                
                ctx.stroke();
            }
        }

        function drawMonthlyChart() {
            const canvas = document.getElementById('monthlyChart');
            if (canvas && canvas.getContext) {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'];
                const losses = [214, 189, 156, 178, 195, 203, 245, 212, 198, 63];
                
                const barWidth = canvas.width / (months.length * 2);
                const maxValue = Math.max(...losses);
                
                losses.forEach((value, index) => {
                    const x = index * barWidth * 2 + barWidth / 2;
                    const barHeight = (value / maxValue) * (canvas.height - 40);
                    const y = canvas.height - barHeight - 20;
                    
                    ctx.fillStyle = value > 200 ? '#ef4444' : '#fbbf24';
                    ctx.fillRect(x, y, barWidth, barHeight);
                    
                    ctx.fillStyle = '#666';
                    ctx.font = '10px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(months[index], x + barWidth / 2, canvas.height - 5);
                    ctx.fillText(value + ' kWh', x + barWidth / 2, y - 5);
                });
            }
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            drawDailyTrendChart();
        });
    </script>
</body>
</html>