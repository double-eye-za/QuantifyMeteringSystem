<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Quantify Metering System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#1A73E8',
                        secondary: '#34A853',
                        danger: '#EA4335',
                        warning: '#FBBC04'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 dark:bg-gray-900">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex-shrink-0">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
                        <i class="fas fa-bolt text-white"></i>
                    </div>
                    <span class="font-bold text-lg text-gray-900 dark:text-white">Quantify</span>
                </div>
            </div>
            
            <nav class="p-4 space-y-2">
                <a href="index.html" class="flex items-center gap-3 px-3 py-2 rounded-lg bg-blue-50 dark:bg-blue-900/20 text-primary">
                    <i class="fas fa-gauge-high w-5"></i>
                    <span class="text-sm font-medium">Dashboard</span>
                </a>
                <a href="estates.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">
                    <i class="fas fa-building w-5"></i>
                    <span class="text-sm font-medium">Estates</span>
                </a>
                <a href="units.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">
                    <i class="fas fa-house w-5"></i>
                    <span class="text-sm font-medium">Units</span>
                </a>
                <a href="meters.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">
                    <i class="fas fa-tachometer-alt w-5"></i>
                    <span class="text-sm font-medium">Meters</span>
                </a>
                <a href="billing.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">
                    <i class="fas fa-wallet w-5"></i>
                    <span class="text-sm font-medium">Billing</span>
                </a>
                <a href="reports.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">
                    <i class="fas fa-chart-line w-5"></i>
                    <span class="text-sm font-medium">Reports</span>
                </a>
                <a href="rate-tables-simplified.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300">
                    <i class="fas fa-table w-5"></i>
                    <span class="text-sm font-medium">Rate Tables</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 overflow-y-auto">
            <!-- Top Bar -->
            <header class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">System Overview</h1>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Real-time monitoring across all estates</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <!-- Period Selector -->
                        <select id="periodSelector" onchange="updateDashboardData()" class="px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                            <option value="year">This Year</option>
                        </select>
                        
                        <!-- Refresh Button -->
                        <button class="p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        
                        <!-- Theme Toggle -->
                        <button id="themeToggle" class="p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white">
                            <i class="fas fa-moon dark:hidden"></i>
                            <i class="fas fa-sun hidden dark:block"></i>
                        </button>
                        
                        <!-- User Menu -->
                        <div class="flex items-center gap-2 pl-3 border-l border-gray-200 dark:border-gray-700">
                            <img src="https://ui-avatars.com/api/?name=Admin&background=1A73E8&color=fff" alt="Admin" class="w-8 h-8 rounded-full">
                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Admin</span>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Main Dashboard Content -->
            <div class="p-6">
                <!-- System-wide KPIs -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4">
                        <div class="flex items-center justify-between mb-2">
                            <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-building text-primary"></i>
                            </div>
                            <span class="text-xs text-gray-500">Live</span>
                        </div>
                        <p class="text-2xl font-bold text-gray-900 dark:text-white">12</p>
                        <p class="text-xs text-gray-600 dark:text-gray-400">Active Estates</p>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4">
                        <div class="flex items-center justify-between mb-2">
                            <div class="w-10 h-10 bg-green-100 dark:bg-green-900/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-house text-green-500"></i>
                            </div>
                            <span class="text-xs text-green-600">+5%</span>
                        </div>
                        <p class="text-2xl font-bold text-gray-900 dark:text-white">1,248</p>
                        <p class="text-xs text-gray-600 dark:text-gray-400">Total Units</p>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4">
                        <div class="flex items-center justify-between mb-2">
                            <div class="w-10 h-10 bg-yellow-100 dark:bg-yellow-900/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-bolt text-yellow-500"></i>
                            </div>
                            <span class="text-xs text-gray-500">Today</span>
                        </div>
                        <p class="text-2xl font-bold text-gray-900 dark:text-white">15.2</p>
                        <p class="text-xs text-gray-600 dark:text-gray-400">MWh Consumed</p>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4">
                        <div class="flex items-center justify-between mb-2">
                            <div class="w-10 h-10 bg-green-100 dark:bg-green-900/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-money-bill-wave text-green-600"></i>
                            </div>
                            <span class="text-xs text-green-600">+12%</span>
                        </div>
                        <p class="text-2xl font-bold text-gray-900 dark:text-white">R 152K</p>
                        <p class="text-xs text-gray-600 dark:text-gray-400">Today's Revenue</p>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4">
                        <div class="flex items-center justify-between mb-2">
                            <div class="w-10 h-10 bg-red-100 dark:bg-red-900/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-exclamation-triangle text-red-500"></i>
                            </div>
                            <span class="text-xs text-red-600">Critical</span>
                        </div>
                        <p class="text-2xl font-bold text-gray-900 dark:text-white">37</p>
                        <p class="text-xs text-gray-600 dark:text-gray-400">Units Disconnected</p>
                    </div>
                </div>

                <!-- Estates Grid View -->
                <div class="mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Estates Performance</h2>
                        <div class="flex gap-2">
                            <button onclick="setView('grid')" id="gridViewBtn" class="px-3 py-1.5 text-sm bg-primary text-white rounded-lg">
                                <i class="fas fa-th mr-1"></i>Grid
                            </button>
                            <button onclick="setView('list')" id="listViewBtn" class="px-3 py-1.5 text-sm bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg">
                                <i class="fas fa-list mr-1"></i>List
                            </button>
                            <input type="text" placeholder="Search estates..." class="px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 w-64">
                        </div>
                    </div>

                    <!-- Grid View -->
                    <div id="gridView" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-4">
                        <!-- Estate Card 1 -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm hover:shadow-lg transition-shadow cursor-pointer" onclick="viewEstateDetails('Willow Creek')">
                            <div class="p-4">
                                <div class="flex items-center justify-between mb-3">
                                    <h3 class="font-semibold text-gray-900 dark:text-white">Willow Creek</h3>
                                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                </div>
                                
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Units</span>
                                        <span class="font-medium text-green-600 dark:text-green-400">50</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Occupied</span>
                                        <span class="font-medium text-green-600 dark:text-green-400">48 (96%)</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Today</span>
                                        <span class="font-medium text-green-600 dark:text-green-400">625 kWh</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Revenue</span>
                                        <span class="font-medium text-green-600 dark:text-green-400">R 12.5K</span>
                                    </div>
                                </div>
                                
                                <div class="mt-3 pt-3 border-t border-gray-200 dark:border-gray-700">
                                    <div class="flex items-center justify-between text-xs">
                                        <span class="text-red-600 dark:text-red-400">
                                            <i class="fas fa-power-off mr-1"></i>2 disconnected
                                        </span>
                                        <span class="text-yellow-600 dark:text-yellow-400">
                                            <i class="fas fa-exclamation mr-1"></i>5 low
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Estate Card 2 -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm hover:shadow-lg transition-shadow cursor-pointer" onclick="viewEstateDetails('Parkview Gardens')">
                            <div class="p-4">
                                <div class="flex items-center justify-between mb-3">
                                    <h3 class="font-semibold text-gray-900 dark:text-white">Parkview Gardens</h3>
                                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                </div>
                                
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Units</span>
                                        <span class="font-medium text-green-600 dark:text-green-400">50</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Occupied</span>
                                        <span class="font-medium text-green-600 dark:text-green-400">45 (90%)</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Today</span>
                                        <span class="font-medium text-green-600 dark:text-green-400">580 kWh</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Revenue</span>
                                        <span class="font-medium text-green-600 dark:text-green-400">R 11.2K</span>
                                    </div>
                                </div>
                                
                                <div class="mt-3 pt-3 border-t border-gray-200 dark:border-gray-700">
                                    <div class="flex items-center justify-between text-xs">
                                        <span class="text-red-600 dark:text-red-400">
                                            <i class="fas fa-power-off mr-1"></i>3 disconnected
                                        </span>
                                        <span class="text-yellow-600 dark:text-yellow-400">
                                            <i class="fas fa-exclamation mr-1"></i>8 low
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- More estate cards... -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm hover:shadow-lg transition-shadow cursor-pointer">
                            <div class="p-4">
                                <div class="flex items-center justify-between mb-3">
                                    <h3 class="font-semibold text-gray-900 dark:text-white">Sunset Ridge</h3>
                                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                </div>
                                
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Units</span>
                                        <span class="font-medium text-green-600 dark:text-green-400">75</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Occupied</span>
                                        <span class="font-medium text-green-600 dark:text-green-400">72 (96%)</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Today</span>
                                        <span class="font-medium text-green-600 dark:text-green-400">892 kWh</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Revenue</span>
                                        <span class="font-medium text-green-600 dark:text-green-400">R 18.3K</span>
                                    </div>
                                </div>
                                
                                <div class="mt-3 pt-3 border-t border-gray-200 dark:border-gray-700">
                                    <div class="flex items-center justify-between text-xs">
                                        <span class="text-green-600 dark:text-green-400">
                                            <i class="fas fa-check mr-1"></i>All active
                                        </span>
                                        <span class="text-yellow-600 dark:text-yellow-400">
                                            <i class="fas fa-exclamation mr-1"></i>3 low
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- List View (Hidden by default) -->
                    <div id="listView" class="hidden">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden">
                            <table class="w-full text-sm">
                                <thead class="bg-gray-50 dark:bg-gray-700">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Estate</th>
                                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Units</th>
                                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Occupied</th>
                                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Today (kWh)</th>
                                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Revenue</th>
                                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
                                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                        <td class="px-4 py-3 font-medium text-gray-900 dark:text-white">Willow Creek</td>
                                        <td class="px-4 py-3 text-center text-gray-900 dark:text-white">50</td>
                                        <td class="px-4 py-3 text-center text-gray-900 dark:text-white">48 (96%)</td>
                                        <td class="px-4 py-3 text-center text-gray-900 dark:text-white">625</td>
                                        <td class="px-4 py-3 text-center text-green-600 dark:text-green-400">R 12.5K</td>
                                        <td class="px-4 py-3 text-center">
                                            <span class="px-2 py-1 text-xs bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 rounded-full">Active</span>
                                        </td>
                                        <td class="px-4 py-3 text-center">
                                            <button onclick="viewEstateDetails('Willow Creek')" class="text-primary hover:underline text-xs">View</button>
                                        </td>
                                    </tr>
                                    <!-- More rows... -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- System Analytics -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Consumption Trend -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">System-wide Consumption Trend</h3>
                        <div class="relative h-64">
                            <canvas id="consumptionChart"></canvas>
                        </div>
                    </div>

                    <!-- Revenue Distribution -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Revenue by Estate</h3>
                        <div class="relative h-64">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Critical Alerts Summary -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">System Alerts by Estate</h3>
                    </div>
                    <div class="p-6">
                        <!-- Willow Creek Estate -->
                        <div class="mb-6">
                            <div class="flex items-center gap-2 mb-3">
                                <i class="fas fa-building text-primary text-sm"></i>
                                <h4 class="font-semibold text-gray-900 dark:text-white">Willow Creek</h4>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
                                <!-- Disconnected Units Alert -->
                                <div class="bg-red-50 dark:bg-red-900/20 rounded-lg px-3 py-2 border border-red-200 dark:border-red-800 flex items-center justify-between gap-2">
                                    <i class="fas fa-power-off text-red-500 text-sm flex-shrink-0"></i>
                                    <span class="text-lg font-bold text-red-600 flex-shrink-0">8</span>
                                    <span class="text-xs font-medium text-gray-900 dark:text-white flex-1">Disconnected</span>
                                    <button class="px-2 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700 flex-shrink-0">
                                        View
                                    </button>
                                </div>
                                
                                <!-- Low Balance Alert -->
                                <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg px-3 py-2 border border-yellow-200 dark:border-yellow-800 flex items-center justify-between gap-2">
                                    <i class="fas fa-exclamation-triangle text-yellow-500 text-sm flex-shrink-0"></i>
                                    <span class="text-lg font-bold text-yellow-600 flex-shrink-0">12</span>
                                    <span class="text-xs font-medium text-gray-900 dark:text-white flex-1">Low Balance</span>
                                    <button class="px-2 py-1 text-xs bg-yellow-600 text-white rounded hover:bg-yellow-700 flex-shrink-0">
                                        View
                                    </button>
                                </div>
                                
                                <!-- Meters Offline Alert -->
                                <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg px-3 py-2 border border-blue-200 dark:border-blue-800 flex items-center justify-between gap-2">
                                    <i class="fas fa-tachometer-alt text-blue-500 text-sm flex-shrink-0"></i>
                                    <span class="text-lg font-bold text-blue-600 flex-shrink-0">3</span>
                                    <span class="text-xs font-medium text-gray-900 dark:text-white flex-1">Meters Offline</span>
                                    <button class="px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 flex-shrink-0">
                                        View
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Parkview Estate -->
                        <div class="mb-6">
                            <div class="flex items-center gap-2 mb-3">
                                <i class="fas fa-building text-primary text-sm"></i>
                                <h4 class="font-semibold text-gray-900 dark:text-white">Parkview</h4>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
                                <!-- Disconnected Units Alert -->
                                <div class="bg-red-50 dark:bg-red-900/20 rounded-lg px-3 py-2 border border-red-200 dark:border-red-800 flex items-center justify-between gap-2">
                                    <i class="fas fa-power-off text-red-500 text-sm flex-shrink-0"></i>
                                    <span class="text-lg font-bold text-red-600 flex-shrink-0">15</span>
                                    <span class="text-xs font-medium text-gray-900 dark:text-white flex-1">Disconnected</span>
                                    <button class="px-2 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700 flex-shrink-0">
                                        View
                                    </button>
                                </div>
                                
                                <!-- Low Balance Alert -->
                                <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg px-3 py-2 border border-yellow-200 dark:border-yellow-800 flex items-center justify-between gap-2">
                                    <i class="fas fa-exclamation-triangle text-yellow-500 text-sm flex-shrink-0"></i>
                                    <span class="text-lg font-bold text-yellow-600 flex-shrink-0">28</span>
                                    <span class="text-xs font-medium text-gray-900 dark:text-white flex-1">Low Balance</span>
                                    <button class="px-2 py-1 text-xs bg-yellow-600 text-white rounded hover:bg-yellow-700 flex-shrink-0">
                                        View
                                    </button>
                                </div>
                                
                                <!-- Meters Offline Alert -->
                                <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg px-3 py-2 border border-blue-200 dark:border-blue-800 flex items-center justify-between gap-2">
                                    <i class="fas fa-tachometer-alt text-blue-500 text-sm flex-shrink-0"></i>
                                    <span class="text-lg font-bold text-blue-600 flex-shrink-0">6</span>
                                    <span class="text-xs font-medium text-gray-900 dark:text-white flex-1">Meters Offline</span>
                                    <button class="px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 flex-shrink-0">
                                        View
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Sunset Ridge Estate -->
                        <div>
                            <div class="flex items-center gap-2 mb-3">
                                <i class="fas fa-building text-primary text-sm"></i>
                                <h4 class="font-semibold text-gray-900 dark:text-white">Sunset Ridge</h4>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
                                <!-- Disconnected Units Alert -->
                                <div class="bg-red-50 dark:bg-red-900/20 rounded-lg px-3 py-2 border border-red-200 dark:border-red-800 flex items-center justify-between gap-2">
                                    <i class="fas fa-power-off text-red-500 text-sm flex-shrink-0"></i>
                                    <span class="text-lg font-bold text-red-600 flex-shrink-0">14</span>
                                    <span class="text-xs font-medium text-gray-900 dark:text-white flex-1">Disconnected</span>
                                    <button class="px-2 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700 flex-shrink-0">
                                        View
                                    </button>
                                </div>
                                
                                <!-- Low Balance Alert -->
                                <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg px-3 py-2 border border-yellow-200 dark:border-yellow-800 flex items-center justify-between gap-2">
                                    <i class="fas fa-exclamation-triangle text-yellow-500 text-sm flex-shrink-0"></i>
                                    <span class="text-lg font-bold text-yellow-600 flex-shrink-0">45</span>
                                    <span class="text-xs font-medium text-gray-900 dark:text-white flex-1">Low Balance</span>
                                    <button class="px-2 py-1 text-xs bg-yellow-600 text-white rounded hover:bg-yellow-700 flex-shrink-0">
                                        View
                                    </button>
                                </div>
                                
                                <!-- Meters Offline Alert -->
                                <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg px-3 py-2 border border-blue-200 dark:border-blue-800 flex items-center justify-between gap-2">
                                    <i class="fas fa-tachometer-alt text-blue-500 text-sm flex-shrink-0"></i>
                                    <span class="text-lg font-bold text-blue-600 flex-shrink-0">6</span>
                                    <span class="text-xs font-medium text-gray-900 dark:text-white flex-1">Meters Offline</span>
                                    <button class="px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 flex-shrink-0">
                                        View
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Estate Details Modal -->
    <div id="estateModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-y-auto">
                <div class="sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-6 py-4">
                    <div class="flex items-center justify-between">
                        <h2 id="estateName" class="text-xl font-bold text-gray-900 dark:text-white">Estate Details</h2>
                        <button onclick="closeEstateModal()" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                
                <div class="p-6">
                    <!-- Estate KPIs -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                            <p class="text-xs text-gray-600 dark:text-gray-400 mb-1">Total Units</p>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">50</p>
                            <p class="text-xs text-green-600">96% occupied</p>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                            <p class="text-xs text-gray-600 dark:text-gray-400 mb-1">Today's Consumption</p>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">625 kWh</p>
                            <p class="text-xs text-blue-600">22,500 L water</p>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                            <p class="text-xs text-gray-600 dark:text-gray-400 mb-1">Today's Revenue</p>
                            <p class="text-2xl font-bold text-green-600">R 12,450</p>
                            <p class="text-xs text-gray-600">+8% vs yesterday</p>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                            <p class="text-xs text-gray-600 dark:text-gray-400 mb-1">System Health</p>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">98%</p>
                            <p class="text-xs text-yellow-600">1 meter offline</p>
                        </div>
                    </div>

                    <!-- Tabs -->
                    <div class="border-b border-gray-200 dark:border-gray-700 mb-6">
                        <nav class="flex space-x-8">
                            <button class="py-2 px-1 border-b-2 border-primary text-primary font-medium text-sm">
                                Analytics
                            </button>
                            <button class="py-2 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm">
                                Units
                            </button>
                            <button class="py-2 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm">
                                Reconciliation
                            </button>
                            <button class="py-2 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm">
                                Billing
                            </button>
                        </nav>
                    </div>

                    <!-- Analytics Content -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Consumption Pattern -->
                        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                            <h4 class="font-semibold text-gray-900 dark:text-white mb-3">24-Hour Consumption Pattern</h4>
                            <div class="relative h-64">
                                <canvas id="hourlyChart"></canvas>
                            </div>
                        </div>

                        <!-- Unit Status Distribution -->
                        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                            <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Unit Status Distribution</h4>
                            <div class="relative h-64">
                                <canvas id="statusChart"></canvas>
                            </div>
                        </div>

                        <!-- Top Consumers -->
                        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                            <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Top 5 Consumers Today</h4>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">Unit B-205</span>
                                    <span class="text-sm font-semibold">45 kWh</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">Unit A-301</span>
                                    <span class="text-sm font-semibold">38 kWh</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">Unit C-102</span>
                                    <span class="text-sm font-semibold">35 kWh</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">Unit D-401</span>
                                    <span class="text-sm font-semibold">32 kWh</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">Unit A-204</span>
                                    <span class="text-sm font-semibold">28 kWh</span>
                                </div>
                            </div>
                        </div>

                        <!-- Critical Units -->
                        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                            <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Critical Units</h4>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center p-2 bg-red-100 dark:bg-red-900/20 rounded">
                                    <span class="text-sm">Unit C-310</span>
                                    <span class="text-xs text-red-600">Disconnected - R0.00</span>
                                </div>
                                <div class="flex justify-between items-center p-2 bg-red-100 dark:bg-red-900/20 rounded">
                                    <span class="text-sm">Unit D-402</span>
                                    <span class="text-xs text-red-600">Disconnected - R0.00</span>
                                </div>
                                <div class="flex justify-between items-center p-2 bg-yellow-100 dark:bg-yellow-900/20 rounded">
                                    <span class="text-sm">Unit A-105</span>
                                    <span class="text-xs text-yellow-600">Low - R32.50</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        
        const savedTheme = localStorage.getItem('theme') || 'light';
        if (savedTheme === 'dark') {
            html.classList.add('dark');
        }

        themeToggle.addEventListener('click', () => {
            html.classList.toggle('dark');
            const currentTheme = html.classList.contains('dark') ? 'dark' : 'light';
            localStorage.setItem('theme', currentTheme);
        });

        // View Toggle
        function setView(view) {
            const gridView = document.getElementById('gridView');
            const listView = document.getElementById('listView');
            const gridBtn = document.getElementById('gridViewBtn');
            const listBtn = document.getElementById('listViewBtn');

            if (view === 'grid') {
                gridView.classList.remove('hidden');
                listView.classList.add('hidden');
                gridBtn.classList.add('bg-primary', 'text-white');
                gridBtn.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                listBtn.classList.remove('bg-primary', 'text-white');
                listBtn.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
            } else {
                gridView.classList.add('hidden');
                listView.classList.remove('hidden');
                listBtn.classList.add('bg-primary', 'text-white');
                listBtn.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                gridBtn.classList.remove('bg-primary', 'text-white');
                gridBtn.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
            }
        }

        // Estate Details Modal
        function viewEstateDetails(estateName) {
            document.getElementById('estateName').textContent = estateName + ' - Detailed Analytics';
            document.getElementById('estateModal').classList.remove('hidden');
            
            // Draw charts when modal opens
            setTimeout(() => {
                drawHourlyChart();
                drawStatusChart();
            }, 100);
        }

        function closeEstateModal() {
            document.getElementById('estateModal').classList.add('hidden');
        }

        // Chart instances storage
        let chartInstances = {};

        // Charts - See updated versions below with period support

        function drawHourlyChart() {
            const ctx = document.getElementById('hourlyChart').getContext('2d');
            
            // Destroy existing chart instance if it exists
            if (chartInstances.hourly) {
                chartInstances.hourly.destroy();
            }
            
            chartInstances.hourly = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['00', '02', '04', '06', '08', '10', '12', '14', '16', '18', '20', '22'],
                    datasets: [{
                        label: 'kWh',
                        data: [15, 12, 10, 25, 45, 40, 35, 38, 42, 55, 48, 20],
                        backgroundColor: 'rgba(59, 130, 246, 0.8)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    }
                }
            });
        }

        function drawStatusChart() {
            const ctx = document.getElementById('statusChart').getContext('2d');
            
            // Destroy existing chart instance if it exists
            if (chartInstances.status) {
                chartInstances.status.destroy();
            }
            
            chartInstances.status = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Active', 'Low Balance', 'Disconnected', 'Vacant'],
                    datasets: [{
                        data: [40, 5, 2, 3],
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(251, 188, 4, 0.8)',
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(156, 163, 175, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // Mock data for different periods
        const mockData = {
            today: {
                revenue: 152000,
                consumption: 15.2,
                disconnected: 37,
                consumptionLabels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '24:00'],
                consumptionElectricity: [8, 6, 9, 14, 16, 18, 12],
                consumptionWater: [5, 4, 8, 10, 9, 11, 7],
                consumptionElectricityCommunal: [3, 2, 3, 5, 6, 7, 4],
                consumptionWaterCommunal: [2, 1.5, 3, 4, 3.5, 4.5, 3],
                revenueByEstate: {
                    labels: ['Willow Creek Units', 'Willow Creek Communal', 'Parkview Units', 'Parkview Communal', 'Sunset Ridge Units', 'Sunset Ridge Communal'],
                    data: [8500, 4000, 7200, 4000, 12300, 6000]
                }
            },
            week: {
                revenue: 1125000,
                consumption: 108.5,
                disconnected: 41,
                consumptionLabels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                consumptionElectricity: [95, 98, 102, 105, 110, 88, 85],
                consumptionWater: [62, 65, 70, 68, 72, 58, 55],
                consumptionElectricityCommunal: [35, 37, 38, 40, 42, 32, 30],
                consumptionWaterCommunal: [22, 24, 26, 25, 27, 20, 18],
                revenueByEstate: {
                    labels: ['Willow Creek Units', 'Willow Creek Communal', 'Parkview Units', 'Parkview Communal', 'Sunset Ridge Units', 'Sunset Ridge Communal'],
                    data: [59500, 29000, 55200, 27000, 91300, 44000]
                }
            },
            month: {
                revenue: 4850000,
                consumption: 465.8,
                disconnected: 52,
                consumptionLabels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                consumptionElectricity: [420, 445, 468, 490],
                consumptionWater: [280, 295, 310, 325],
                consumptionElectricityCommunal: [155, 165, 175, 185],
                consumptionWaterCommunal: [105, 110, 115, 122],
                revenueByEstate: {
                    labels: ['Willow Creek Units', 'Willow Creek Communal', 'Parkview Units', 'Parkview Communal', 'Sunset Ridge Units', 'Sunset Ridge Communal'],
                    data: [256000, 124000, 239000, 116000, 314000, 151000]
                }
            },
            year: {
                revenue: 58200000,
                consumption: 5589.6,
                disconnected: 68,
                consumptionLabels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                consumptionElectricity: [450, 430, 420, 410, 425, 440, 480, 490, 475, 465, 455, 485],
                consumptionWater: [300, 285, 275, 265, 280, 295, 320, 330, 315, 310, 305, 325],
                consumptionElectricityCommunal: [170, 162, 158, 155, 160, 165, 180, 185, 178, 175, 172, 182],
                consumptionWaterCommunal: [112, 107, 103, 100, 105, 110, 120, 124, 118, 116, 114, 122],
                revenueByEstate: {
                    labels: ['Willow Creek Units', 'Willow Creek Communal', 'Parkview Units', 'Parkview Communal', 'Sunset Ridge Units', 'Sunset Ridge Communal'],
                    data: [3072000, 1488000, 2868000, 1392000, 3798000, 1842000]
                }
            }
        };

        // Update dashboard data based on selected period
        function updateDashboardData() {
            const period = document.getElementById('periodSelector').value;
            const data = mockData[period];
            
            // Update KPI cards
            document.querySelector('.text-2xl.font-bold.text-gray-900.dark\\:text-white').textContent = 
                'R ' + (data.revenue / 1000).toFixed(0) + 'K';
            
            // Update consumption
            const consumptionCards = document.querySelectorAll('.text-2xl.font-bold.text-gray-900.dark\\:text-white');
            if (consumptionCards[2]) {
                consumptionCards[2].textContent = data.consumption.toFixed(1);
            }
            
            // Update disconnected count
            if (consumptionCards[4]) {
                consumptionCards[4].textContent = data.disconnected;
            }
            
            // Update charts
            drawConsumptionChart(data);
            drawRevenueChart(data);
        }

        // Update consumption chart to accept data parameter
        function drawConsumptionChart(periodData = null) {
            const data = periodData || mockData.today;
            const ctx = document.getElementById('consumptionChart').getContext('2d');
            const isDark = document.documentElement.classList.contains('dark');
            const themeTextColor = isDark ? '#e5e7eb' : '#374151';
            
            // Destroy existing chart instance if it exists
            if (chartInstances.consumption) {
                chartInstances.consumption.destroy();
            }
            
            chartInstances.consumption = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.consumptionLabels,
                    datasets: [{
                        label: 'Electricity - Units (MWh)',
                        data: data.consumptionElectricity,
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        borderWidth: 2
                    }, {
                        label: 'Water - Units (kL)',
                        data: data.consumptionWater,
                        borderColor: 'rgb(16, 185, 129)',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        borderWidth: 2
                    }, {
                        label: 'Electricity - Communal (MWh)',
                        data: data.consumptionElectricityCommunal,
                        borderColor: 'rgb(147, 197, 253)',
                        backgroundColor: 'rgba(147, 197, 253, 0.1)',
                        tension: 0.4,
                        borderWidth: 2,
                        borderDash: [5, 5]
                    }, {
                        label: 'Water - Communal (kL)',
                        data: data.consumptionWaterCommunal,
                        borderColor: 'rgb(134, 239, 172)',
                        backgroundColor: 'rgba(134, 239, 172, 0.1)',
                        tension: 0.4,
                        borderWidth: 2,
                        borderDash: [5, 5]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    scales: {
                        x: {
                            ticks: { color: themeTextColor },
                            grid: { color: isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.05)' }
                        },
                        y: {
                            ticks: { color: themeTextColor },
                            grid: { color: isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.05)' }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: {
                                    size: 11
                                },
                                padding: 8,
                                usePointStyle: true,
                                color: themeTextColor
                            }
                        }
                    }
                }
            });
        }

        // Update revenue chart to accept data parameter
        function drawRevenueChart(periodData = null) {
            const data = periodData || mockData.today;
            const ctx = document.getElementById('revenueChart').getContext('2d');
            const isDark = document.documentElement.classList.contains('dark');
            const themeTextColor = isDark ? '#e5e7eb' : '#374151';
            
            // Destroy existing chart instance if it exists
            if (chartInstances.revenue) {
                chartInstances.revenue.destroy();
            }
            
            chartInstances.revenue = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.revenueByEstate.labels,
                    datasets: [{
                        label: 'Revenue',
                        data: data.revenueByEstate.data,
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.8)',      // Willow Units
                            'rgba(59, 130, 246, 0.3)',      // Willow Communal
                            'rgba(16, 185, 129, 0.8)',      // Parkview Units
                            'rgba(16, 185, 129, 0.3)',      // Parkview Communal
                            'rgba(251, 188, 4, 0.8)',       // Sunset Ridge Units - solid yellow
                            'rgba(251, 188, 4, 0.3)'        // Sunset Ridge Communal - greyed yellow
                        ],
                        borderColor: '#1f2937'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            ticks: { color: themeTextColor },
                            grid: { color: isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.05)' }
                        },
                        y: {
                            ticks: { color: themeTextColor },
                            grid: { color: isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.05)' }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                font: { size: 11 },
                                color: themeTextColor
                            }
                        }
                    }
                }
            });
        }

        // Initialize charts on load
        window.addEventListener('load', () => {
            drawConsumptionChart();
            drawRevenueChart();
        });

        // Close modal on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeEstateModal();
            }
        });
    </script>
</body>
</html>