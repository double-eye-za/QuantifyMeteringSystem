"""initial schema

Revision ID: 83534d9c1245
Revises: 
Create Date: 2025-10-14 15:06:43.128719

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = '83534d9c1245'
down_revision = None
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('meters',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('serial_number', sa.String(length=100), nullable=False),
    sa.Column('meter_type', sa.String(length=20), nullable=False),
    sa.Column('manufacturer', sa.String(length=100), nullable=True),
    sa.Column('model', sa.String(length=100), nullable=True),
    sa.Column('installation_date', sa.Date(), nullable=True),
    sa.Column('last_reading', sa.Numeric(precision=15, scale=3), nullable=True),
    sa.Column('last_reading_date', sa.DateTime(), nullable=True),
    sa.Column('communication_type', sa.String(length=20), nullable=True),
    sa.Column('communication_status', sa.String(length=20), nullable=True),
    sa.Column('last_communication', sa.DateTime(), nullable=True),
    sa.Column('firmware_version', sa.String(length=50), nullable=True),
    sa.Column('is_prepaid', sa.Boolean(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.CheckConstraint("communication_status IN ('online','offline','error')", name='ck_meters_comm_status'),
    sa.CheckConstraint("communication_type IN ('plc','cellular','wifi','manual')", name='ck_meters_comm_type'),
    sa.CheckConstraint("meter_type IN ('electricity','water','solar','bulk_electricity','bulk_water')", name='ck_meters_type'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('serial_number')
    )
    op.create_table('notifications',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('recipient_type', sa.String(length=20), nullable=False),
    sa.Column('recipient_id', sa.Integer(), nullable=True),
    sa.Column('notification_type', sa.String(length=50), nullable=False),
    sa.Column('subject', sa.String(length=255), nullable=True),
    sa.Column('message', sa.Text(), nullable=False),
    sa.Column('priority', sa.String(length=20), nullable=True),
    sa.Column('channel', sa.String(length=20), nullable=False),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('sent_at', sa.DateTime(), nullable=True),
    sa.Column('read_at', sa.DateTime(), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('push_token', sa.Text(), nullable=True),
    sa.Column('push_provider', sa.String(length=20), nullable=True),
    sa.Column('push_payload', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.CheckConstraint("channel IN ('email','sms','push','in_app')", name='ck_notifications_channel'),
    sa.CheckConstraint("priority IN ('low','normal','high','critical')", name='ck_notifications_priority'),
    sa.CheckConstraint("recipient_type IN ('user','resident','system')", name='ck_notifications_recipient_type'),
    sa.CheckConstraint("status IN ('pending','sent','delivered','failed','read')", name='ck_notifications_status'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('roles',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('name', sa.String(length=50), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('permissions', sa.Text(), nullable=False),
    sa.Column('is_system_role', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name')
    )
    op.create_table('meter_readings',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('meter_id', sa.Integer(), nullable=False),
    sa.Column('reading_value', sa.Numeric(precision=15, scale=3), nullable=False),
    sa.Column('reading_date', sa.DateTime(), nullable=False),
    sa.Column('reading_type', sa.String(length=20), nullable=True),
    sa.Column('consumption_since_last', sa.Numeric(precision=15, scale=3), nullable=True),
    sa.Column('is_validated', sa.Boolean(), nullable=True),
    sa.Column('validation_date', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.CheckConstraint("reading_type IN ('automatic','manual','estimated')", name='ck_meter_readings_type'),
    sa.ForeignKeyConstraint(['meter_id'], ['meters.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('users',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('username', sa.String(length=64), nullable=False),
    sa.Column('email', sa.String(length=255), nullable=False),
    sa.Column('password_hash', sa.String(length=255), nullable=False),
    sa.Column('first_name', sa.String(length=100), nullable=False),
    sa.Column('last_name', sa.String(length=100), nullable=False),
    sa.Column('phone', sa.String(length=20), nullable=True),
    sa.Column('role_id', sa.Integer(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('last_login', sa.DateTime(), nullable=True),
    sa.Column('failed_login_attempts', sa.Integer(), nullable=True),
    sa.Column('locked_until', sa.DateTime(), nullable=True),
    sa.Column('created_by', sa.Integer(), nullable=True),
    sa.Column('updated_by', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['role_id'], ['roles.id'], ),
    sa.ForeignKeyConstraint(['updated_by'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('email'),
    sa.UniqueConstraint('username')
    )
    op.create_table('audit_logs',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=True),
    sa.Column('action', sa.String(length=100), nullable=False),
    sa.Column('entity_type', sa.String(length=50), nullable=True),
    sa.Column('entity_id', sa.Integer(), nullable=True),
    sa.Column('old_values', sa.Text(), nullable=True),
    sa.Column('new_values', sa.Text(), nullable=True),
    sa.Column('ip_address', sa.String(), nullable=True),
    sa.Column('user_agent', sa.Text(), nullable=True),
    sa.Column('request_id', sa.String(length=36), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('meter_alerts',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('meter_id', sa.Integer(), nullable=False),
    sa.Column('alert_type', sa.String(length=50), nullable=False),
    sa.Column('severity', sa.String(length=20), nullable=False),
    sa.Column('message', sa.Text(), nullable=True),
    sa.Column('is_resolved', sa.Boolean(), nullable=True),
    sa.Column('resolved_at', sa.DateTime(), nullable=True),
    sa.Column('resolved_by', sa.Integer(), nullable=True),
    sa.Column('resolution_notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.CheckConstraint("alert_type IN ('communication_loss','tamper_detected','low_credit','disconnection','reconnection','abnormal_usage','meter_fault')", name='ck_meter_alerts_type'),
    sa.CheckConstraint("severity IN ('info','warning','error','critical')", name='ck_meter_alerts_severity'),
    sa.ForeignKeyConstraint(['meter_id'], ['meters.id'], ),
    sa.ForeignKeyConstraint(['resolved_by'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('rate_tables',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('utility_type', sa.String(length=20), nullable=False),
    sa.Column('rate_structure', sa.Text(), nullable=False),
    sa.Column('is_default', sa.Boolean(), nullable=True),
    sa.Column('effective_from', sa.Date(), nullable=False),
    sa.Column('effective_to', sa.Date(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('created_by', sa.Integer(), nullable=True),
    sa.Column('updated_by', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.CheckConstraint("utility_type IN ('electricity','water','solar')", name='ck_rate_tables_utility_type'),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['updated_by'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('residents',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('id_number', sa.String(length=20), nullable=True),
    sa.Column('first_name', sa.String(length=100), nullable=False),
    sa.Column('last_name', sa.String(length=100), nullable=False),
    sa.Column('email', sa.String(length=255), nullable=False),
    sa.Column('phone', sa.String(length=20), nullable=False),
    sa.Column('alternate_phone', sa.String(length=20), nullable=True),
    sa.Column('emergency_contact_name', sa.String(length=200), nullable=True),
    sa.Column('emergency_contact_phone', sa.String(length=20), nullable=True),
    sa.Column('lease_start_date', sa.Date(), nullable=True),
    sa.Column('lease_end_date', sa.Date(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('app_user_id', sa.String(length=36), nullable=True),
    sa.Column('created_by', sa.Integer(), nullable=True),
    sa.Column('updated_by', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['updated_by'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('email'),
    sa.UniqueConstraint('id_number')
    )
    op.create_table('system_settings',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('setting_key', sa.String(length=100), nullable=False),
    sa.Column('setting_value', sa.Text(), nullable=True),
    sa.Column('setting_type', sa.String(length=20), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('category', sa.String(length=50), nullable=True),
    sa.Column('is_encrypted', sa.Boolean(), nullable=True),
    sa.Column('updated_by', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.CheckConstraint("setting_type IN ('string','number','boolean','json')", name='ck_system_settings_type'),
    sa.ForeignKeyConstraint(['updated_by'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('setting_key')
    )
    op.create_table('estates',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('code', sa.String(length=20), nullable=False),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('address', sa.Text(), nullable=True),
    sa.Column('city', sa.String(length=100), nullable=True),
    sa.Column('postal_code', sa.String(length=10), nullable=True),
    sa.Column('contact_name', sa.String(length=200), nullable=True),
    sa.Column('contact_phone', sa.String(length=20), nullable=True),
    sa.Column('contact_email', sa.String(length=255), nullable=True),
    sa.Column('total_units', sa.Integer(), nullable=False),
    sa.Column('bulk_electricity_meter_id', sa.Integer(), nullable=True),
    sa.Column('bulk_water_meter_id', sa.Integer(), nullable=True),
    sa.Column('electricity_rate_table_id', sa.Integer(), nullable=True),
    sa.Column('water_rate_table_id', sa.Integer(), nullable=True),
    sa.Column('electricity_markup_percentage', sa.Numeric(precision=5, scale=2), nullable=True),
    sa.Column('water_markup_percentage', sa.Numeric(precision=5, scale=2), nullable=True),
    sa.Column('solar_free_allocation_kwh', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('created_by', sa.Integer(), nullable=True),
    sa.Column('updated_by', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['bulk_electricity_meter_id'], ['meters.id'], ),
    sa.ForeignKeyConstraint(['bulk_water_meter_id'], ['meters.id'], ),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['electricity_rate_table_id'], ['rate_tables.id'], ),
    sa.ForeignKeyConstraint(['updated_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['water_rate_table_id'], ['rate_tables.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('code')
    )
    op.create_table('rate_table_tiers',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('rate_table_id', sa.Integer(), nullable=False),
    sa.Column('tier_number', sa.Integer(), nullable=False),
    sa.Column('from_kwh', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('to_kwh', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('rate_per_kwh', sa.Numeric(precision=10, scale=4), nullable=False),
    sa.Column('description', sa.String(length=255), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['rate_table_id'], ['rate_tables.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('rate_table_id', 'tier_number', name='uq_rate_table_tier_unique')
    )
    op.create_table('time_of_use_rates',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('rate_table_id', sa.Integer(), nullable=False),
    sa.Column('period_name', sa.String(length=50), nullable=False),
    sa.Column('start_time', sa.Time(), nullable=False),
    sa.Column('end_time', sa.Time(), nullable=False),
    sa.Column('weekdays', sa.Boolean(), nullable=True),
    sa.Column('weekends', sa.Boolean(), nullable=True),
    sa.Column('rate_per_kwh', sa.Numeric(precision=10, scale=4), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['rate_table_id'], ['rate_tables.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('reconciliation_reports',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('estate_id', sa.Integer(), nullable=False),
    sa.Column('report_date', sa.Date(), nullable=False),
    sa.Column('utility_type', sa.String(length=20), nullable=False),
    sa.Column('bulk_meter_reading', sa.Numeric(precision=15, scale=3), nullable=False),
    sa.Column('sum_unit_readings', sa.Numeric(precision=15, scale=3), nullable=False),
    sa.Column('variance', sa.Numeric(precision=15, scale=3), nullable=False),
    sa.Column('variance_percentage', sa.Numeric(precision=5, scale=2), nullable=True),
    sa.Column('loss_amount', sa.Numeric(precision=15, scale=3), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('created_by', sa.Integer(), nullable=True),
    sa.CheckConstraint("utility_type IN ('electricity','water')", name='ck_reconciliation_utility'),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['estate_id'], ['estates.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('estate_id', 'report_date', 'utility_type', name='uq_reconciliation_unique')
    )
    op.create_table('units',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('estate_id', sa.Integer(), nullable=False),
    sa.Column('unit_number', sa.String(length=50), nullable=False),
    sa.Column('floor', sa.String(length=20), nullable=True),
    sa.Column('building', sa.String(length=50), nullable=True),
    sa.Column('bedrooms', sa.Integer(), nullable=True),
    sa.Column('bathrooms', sa.Integer(), nullable=True),
    sa.Column('size_sqm', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('occupancy_status', sa.String(length=20), nullable=True),
    sa.Column('resident_id', sa.Integer(), nullable=True),
    sa.Column('electricity_meter_id', sa.Integer(), nullable=True),
    sa.Column('water_meter_id', sa.Integer(), nullable=True),
    sa.Column('solar_meter_id', sa.Integer(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('created_by', sa.Integer(), nullable=True),
    sa.Column('updated_by', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.CheckConstraint("occupancy_status IN ('occupied','vacant','maintenance')", name='ck_units_occupancy_status'),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['electricity_meter_id'], ['meters.id'], ),
    sa.ForeignKeyConstraint(['estate_id'], ['estates.id'], ),
    sa.ForeignKeyConstraint(['resident_id'], ['residents.id'], ),
    sa.ForeignKeyConstraint(['solar_meter_id'], ['meters.id'], ),
    sa.ForeignKeyConstraint(['updated_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['water_meter_id'], ['meters.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('estate_id', 'unit_number', name='uq_units_estate_unit_number')
    )
    op.create_table('wallets',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('unit_id', sa.Integer(), nullable=False),
    sa.Column('balance', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('electricity_balance', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('water_balance', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('solar_balance', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('low_balance_threshold', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('low_balance_alert_type', sa.String(length=20), nullable=True),
    sa.Column('low_balance_days_threshold', sa.Integer(), nullable=True),
    sa.Column('last_low_balance_alert', sa.DateTime(), nullable=True),
    sa.Column('alert_frequency_hours', sa.Integer(), nullable=True),
    sa.Column('electricity_minimum_activation', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('water_minimum_activation', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('auto_topup_enabled', sa.Boolean(), nullable=True),
    sa.Column('auto_topup_amount', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('auto_topup_threshold', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('daily_avg_consumption', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('last_consumption_calc_date', sa.DateTime(), nullable=True),
    sa.Column('is_suspended', sa.Boolean(), nullable=True),
    sa.Column('suspension_reason', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.CheckConstraint('electricity_minimum_activation >= 0', name='ck_wallets_elec_min'),
    sa.CheckConstraint('water_minimum_activation >= 0', name='ck_wallets_water_min'),
    sa.ForeignKeyConstraint(['unit_id'], ['units.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('unit_id')
    )
    op.create_table('payment_methods',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('wallet_id', sa.Integer(), nullable=False),
    sa.Column('method_type', sa.String(length=20), nullable=False),
    sa.Column('card_token', sa.String(length=255), nullable=True),
    sa.Column('card_last4', sa.String(length=4), nullable=True),
    sa.Column('card_brand', sa.String(length=20), nullable=True),
    sa.Column('card_exp_month', sa.Integer(), nullable=True),
    sa.Column('card_exp_year', sa.Integer(), nullable=True),
    sa.Column('bank_name', sa.String(length=100), nullable=True),
    sa.Column('account_last4', sa.String(length=4), nullable=True),
    sa.Column('account_type', sa.String(length=20), nullable=True),
    sa.Column('is_default', sa.Boolean(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('last_used_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.CheckConstraint("method_type IN ('card','bank_account')", name='ck_payment_methods_type'),
    sa.CheckConstraint('card_exp_month IS NULL OR (card_exp_month BETWEEN 1 AND 12)', name='ck_payment_methods_exp_month'),
    sa.ForeignKeyConstraint(['wallet_id'], ['wallets.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('wallet_id', 'card_token', name='uq_payment_methods_wallet_cardtoken')
    )
    op.create_table('transactions',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('transaction_number', sa.String(length=50), nullable=False),
    sa.Column('wallet_id', sa.Integer(), nullable=False),
    sa.Column('transaction_type', sa.String(length=30), nullable=False),
    sa.Column('amount', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('balance_before', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('balance_after', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('reference', sa.String(length=255), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('payment_method', sa.String(length=20), nullable=True),
    sa.Column('payment_gateway', sa.String(length=50), nullable=True),
    sa.Column('payment_gateway_ref', sa.String(length=255), nullable=True),
    sa.Column('payment_gateway_status', sa.String(length=50), nullable=True),
    sa.Column('payment_metadata', sa.Text(), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('initiated_at', sa.DateTime(), nullable=True),
    sa.Column('completed_at', sa.DateTime(), nullable=True),
    sa.Column('expires_at', sa.DateTime(), nullable=True),
    sa.Column('reconciled', sa.Boolean(), nullable=True),
    sa.Column('reconciled_at', sa.DateTime(), nullable=True),
    sa.Column('meter_id', sa.Integer(), nullable=True),
    sa.Column('consumption_kwh', sa.Numeric(precision=10, scale=3), nullable=True),
    sa.Column('rate_applied', sa.Numeric(precision=10, scale=4), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('created_by', sa.Integer(), nullable=True),
    sa.CheckConstraint("payment_method IS NULL OR payment_method IN ('eft','card','instant_eft','cash','system','adjustment')", name='ck_transactions_payment_method'),
    sa.CheckConstraint("status IN ('pending','processing','completed','failed','reversed','expired')", name='ck_transactions_status'),
    sa.CheckConstraint("transaction_type IN (\n            'topup','purchase_electricity','purchase_water','purchase_solar',\n            'consumption_electricity','consumption_water','consumption_solar',\n            'refund','adjustment','service_charge'\n        )", name='ck_transactions_type'),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['meter_id'], ['meters.id'], ),
    sa.ForeignKeyConstraint(['wallet_id'], ['wallets.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('transaction_number')
    )
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table('transactions')
    op.drop_table('payment_methods')
    op.drop_table('wallets')
    op.drop_table('units')
    op.drop_table('reconciliation_reports')
    op.drop_table('time_of_use_rates')
    op.drop_table('rate_table_tiers')
    op.drop_table('estates')
    op.drop_table('system_settings')
    op.drop_table('residents')
    op.drop_table('rate_tables')
    op.drop_table('meter_alerts')
    op.drop_table('audit_logs')
    op.drop_table('users')
    op.drop_table('meter_readings')
    op.drop_table('roles')
    op.drop_table('notifications')
    op.drop_table('meters')
    # ### end Alembic commands ###
