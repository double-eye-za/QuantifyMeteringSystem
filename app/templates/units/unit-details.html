{% extends "base.html" %} {% block title %}Unit {{ unit.unit_number or unit.id
}} Details - Quantify Metering System{% endblock %} {% block page_title %}Unit
{{ unit.unit_number or unit.id }} Details{% endblock %} {% block breadcrumb %}

<a href="{{ url_for('api_v1.dashboard') }}" class="hover:text-primary">Home</a>
<span class="mx-1">/</span>
<a href="{{ url_for('api_v1.estates_page') }}" class="hover:text-primary"
  >Estates</a
>
<span class="mx-1">/</span>
<a href="{{ url_for('api_v1.units_page') }}" class="hover:text-primary"
  >Units</a
>
<span class="mx-1">/</span>
<span>Unit {{ unit.unit_number or unit.id }}</span>
{% endblock %} {% block content %} {% if unit.wallet_low_balance %}
<div
  class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-300 dark:border-yellow-700 rounded-lg p-4 mb-6"
>
  <div class="flex items-center">
    <i class="fas fa-exclamation-triangle text-yellow-600 text-xl mr-3"></i>
    <div class="flex-1">
      <p class="text-sm font-semibold text-yellow-800 dark:text-yellow-200">
        Low Wallet Balance Warning
      </p>
      <p class="text-xs text-yellow-600 dark:text-yellow-400 mt-1">
        This unit has only R {{ unit.wallet_balance | default(0) }} remaining.
      </p>
    </div>
    <button
      class="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700"
    >
      <i class="fas fa-credit-card mr-2"></i>Top Up Now
    </button>
  </div>
</div>
{% endif %}

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
  <!-- Left Column - Unit & Resident Info -->
  <div class="lg:col-span-1 space-y-6">
    <!-- Unit Information -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
        <i class="fas fa-home text-primary mr-2"></i>Unit Information
      </h3>
      <div class="space-y-3">
        <div
          class="flex justify-between py-2 border-b border-gray-100 dark:border-gray-700"
        >
          <span class="text-sm text-gray-600 dark:text-gray-400"
            >Unit Number</span
          >
          <span class="text-sm font-medium text-gray-900 dark:text-white"
            >{{ unit.unit_number or '-' }}</span
          >
        </div>
        <div
          class="flex justify-between py-2 border-b border-gray-100 dark:border-gray-700"
        >
          <span class="text-sm text-gray-600 dark:text-gray-400">Estate</span>
          <span class="text-sm font-medium text-gray-900 dark:text-white"
            >{{ estate.name if estate else '-' }}</span
          >
        </div>
        <div
          class="flex justify-between py-2 border-b border-gray-100 dark:border-gray-700"
        >
          <span class="text-sm text-gray-600 dark:text-gray-400">Floor</span>
          <span class="text-sm font-medium text-gray-900 dark:text-white"
            >{{ unit.floor or '-' }}</span
          >
        </div>
        <div
          class="flex justify-between py-2 border-b border-gray-100 dark:border-gray-700"
        >
          <span class="text-sm text-gray-600 dark:text-gray-400">Size</span>
          <span class="text-sm font-medium text-gray-900 dark:text-white"
            >{{ (unit.size_sqm ~ ' mÂ²') if unit.size_sqm else '-' }}</span
          >
        </div>
        <div class="flex justify-between py-2">
          <span class="text-sm text-gray-600 dark:text-gray-400"
            >Occupancy Status</span
          >
          <span
            class="inline-flex items-center px-2 py-1 rounded text-xs {{ 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300' if unit.occupancy_status=='occupied' else 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300' }}"
          >
            <i
              class="fas {{ 'fa-check-circle' if unit.occupancy_status=='occupied' else 'fa-circle' }} mr-1"
            ></i
            >{{ unit.occupancy_status or '-' }}
          </span>
        </div>
      </div>
    </div>

    <!-- Resident Contact Details -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
        <i class="fas fa-user text-primary mr-2"></i>Resident Details
      </h3>
      <div class="space-y-3">
        <div
          class="flex justify-between py-2 border-b border-gray-100 dark:border-gray-700"
        >
          <span class="text-sm text-gray-600 dark:text-gray-400">Name</span>
          <span class="text-sm font-medium text-gray-900 dark:text-white"
            >{{ (resident.first_name ~ ' ' ~ resident.last_name) if resident
            else '-' }}</span
          >
        </div>
        <div
          class="flex justify-between py-2 border-b border-gray-100 dark:border-gray-700"
        >
          <span class="text-sm text-gray-600 dark:text-gray-400"
            >ID Number</span
          >
          <span class="text-sm font-medium text-gray-900 dark:text-white"
            >{{ resident.id_number if resident and resident.id_number else '-'
            }}</span
          >
        </div>
        <div
          class="flex justify-between py-2 border-b border-gray-100 dark:border-gray-700"
        >
          <span class="text-sm text-gray-600 dark:text-gray-400">Mobile</span>
          <span class="text-sm font-medium text-gray-900 dark:text-white">
            {{ resident.phone if resident and resident.phone else '-' }} {% if
            resident and resident.phone %}
            <button class="ml-2 text-primary hover:text-blue-700">
              <i class="fas fa-phone text-xs"></i>
            </button>
            {% endif %}
          </span>
        </div>
        <div
          class="flex justify-between py-2 border-b border-gray-100 dark:border-gray-700"
        >
          <span class="text-sm text-gray-600 dark:text-gray-400">Email</span>
          <span class="text-sm font-medium text-gray-900 dark:text-white">
            {{ resident.email if resident and resident.email else '-' }} {% if
            resident and resident.email %}
            <button class="ml-2 text-primary hover:text-blue-700">
              <i class="fas fa-envelope text-xs"></i>
            </button>
            {% endif %}
          </span>
        </div>
        <div class="flex justify-between py-2">
          <span class="text-sm text-gray-600 dark:text-gray-400"
            >Move-in Date</span
          >
          <span class="text-sm font-medium text-gray-900 dark:text-white"
            >{{ resident.move_in_date if resident and resident.move_in_date else
            '-' }}</span
          >
        </div>
      </div>

      {% if resident %}
      <button
        class="w-full mt-4 px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600"
      >
        <i class="fas fa-message mr-2"></i>Send SMS Notification
      </button>
      {% endif %}
    </div>
  </div>

  <!-- Center Column - Wallet & Meters -->
  <div class="lg:col-span-2 space-y-6">
    <!-- Prepaid Wallet Status (static placeholders until backend data exists) -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
          <i class="fas fa-wallet text-primary mr-2"></i>Prepaid Wallet & Solar
          Allocation
        </h3>
        <button
          class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-600"
        >
          <i class="fas fa-plus-circle mr-2"></i>Top Up Wallet
        </button>
      </div>

      <!-- Wallet metrics -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div
          class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 border border-yellow-200 dark:border-yellow-800"
        >
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-gray-700 dark:text-gray-300"
              >Wallet Balance</span
            >
            <i class="fas fa-exclamation-triangle text-yellow-500"></i>
          </div>
          <div class="text-2xl font-bold text-yellow-600">
            R {{ wallet.balance | format_number(2) if wallet else '0.00' }}
          </div>
        </div>

        <div
          class="bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800"
        >
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-gray-700 dark:text-gray-300"
              >Free Solar</span
            >
            <i class="fas fa-solar-panel text-green-500"></i>
          </div>
          <div class="text-2xl font-bold text-green-600">
            {{ wallet.solar_balance | format_number(2) if wallet else '0' }} kWh
          </div>
        </div>

        <div
          class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800"
        >
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-gray-700 dark:text-gray-300"
              >Low Balance Threshold</span
            >
            <i class="fas fa-info-circle text-blue-500"></i>
          </div>
          <div class="text-2xl font-bold text-blue-600">
            R {{ wallet.low_balance_threshold | format_number(2) if wallet else
            '0.00' }}
          </div>
        </div>
      </div>

      <!-- Recent transactions list -->
      <div class="mt-4 border-t border-gray-200 dark:border-gray-700 pt-4">
        <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
          Recent Transactions
        </h4>
        {% if recent_transactions and recent_transactions|length > 0 %}
        <div class="overflow-x-auto">
          <table class="w-full text-xs">
            <thead class="bg-gray-50 dark:bg-gray-700">
              <tr>
                <th
                  class="px-3 py-2 text-left text-gray-600 dark:text-gray-300"
                >
                  Date
                </th>
                <th
                  class="px-3 py-2 text-left text-gray-600 dark:text-gray-300"
                >
                  Type
                </th>
                <th
                  class="px-3 py-2 text-right text-gray-600 dark:text-gray-300"
                >
                  Amount
                </th>
                <th
                  class="px-3 py-2 text-left text-gray-600 dark:text-gray-300"
                >
                  Status
                </th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
              {% for txn in recent_transactions %}
              <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                <td class="px-3 py-2 text-gray-900 dark:text-white">
                  {{ txn.completed_at.strftime('%b %d, %Y') if txn.completed_at
                  else 'Pending' }}
                </td>
                <td class="px-3 py-2 text-gray-900 dark:text-white">
                  {{ txn.transaction_type.replace('_', ' ')|title }}
                </td>
                <td
                  class="px-3 py-2 text-right {% if txn.transaction_type == 'topup' %}text-green-600{% else %}text-red-600{% endif %}"
                >
                  {% if txn.transaction_type == 'topup' %}+{% else %}-{% endif
                  %}R {{ txn.amount | format_number(2) }}
                </td>
                <td class="px-3 py-2">
                  <span
                    class="px-2 py-1 rounded text-xs {% if txn.status == 'completed' %}bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200{% elif txn.status == 'pending' %}bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200{% else %}bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200{% endif %}"
                  >
                    {{ txn.status|title }}
                  </span>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="text-xs text-gray-500 dark:text-gray-400">
          No transactions yet.
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Individual Meter Readings (static placeholders) -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
        <i class="fas fa-tachometer-alt text-primary mr-2"></i>Live Meter
        Readings
      </h3>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <!-- Electricity Meter -->
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center">
              <i class="fas fa-bolt text-yellow-500 mr-2"></i>
              <span class="font-medium text-gray-900 dark:text-white"
                >Electricity</span
              >
            </div>
            <span
              class="inline-flex items-center px-2 py-1 rounded text-xs bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200"
            >
              <i class="fas fa-circle mr-1 text-xs"></i>Active
            </span>
          </div>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-600 dark:text-gray-400">Meter ID</span>
              <span class="font-mono text-gray-900 dark:text-white"
                >{{ unit.electricity_meter_id or '-' }}</span
              >
            </div>
            {% if meter_readings.get('electricity') %}
            <div class="flex justify-between">
              <span class="text-gray-600 dark:text-gray-400">Reading</span>
              <span class="font-semibold text-gray-900 dark:text-white"
                >{{ meter_readings.get('electricity').reading_value |
                format_number(2) }} kWh</span
              >
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600 dark:text-gray-400">Date</span>
              <span class="text-gray-900 dark:text-white"
                >{{ meter_readings.get('electricity').reading_date.strftime('%b
                %d, %Y') if meter_readings.get('electricity').reading_date else
                '-' }}</span
              >
            </div>
            {% else %}
            <div
              class="text-xs text-gray-500 dark:text-gray-400 text-center py-2"
            >
              No readings
            </div>
            {% endif %}
          </div>
        </div>

        <!-- Water Meter -->
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center">
              <i class="fas fa-tint text-blue-500 mr-2"></i>
              <span class="font-medium text-gray-900 dark:text-white"
                >Water</span
              >
            </div>
            <span
              class="inline-flex items-center px-2 py-1 rounded text-xs bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"
            >
              <i class="fas fa-circle mr-1 text-xs"></i>Active
            </span>
          </div>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-600 dark:text-gray-400">Meter ID</span>
              <span class="font-mono text-gray-900 dark:text-white"
                >{{ unit.water_meter_id or '-' }}</span
              >
            </div>
            {% if meter_readings.get('water') %}
            <div class="flex justify-between">
              <span class="text-gray-600 dark:text-gray-400">Reading</span>
              <span class="font-semibold text-gray-900 dark:text-white"
                >{{ meter_readings.get('water').reading_value | format_number(2)
                }} kL</span
              >
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600 dark:text-gray-400">Date</span>
              <span class="text-gray-900 dark:text-white"
                >{{ meter_readings.get('water').reading_date.strftime('%b %d,
                %Y') if meter_readings.get('water').reading_date else '-'
                }}</span
              >
            </div>
            {% else %}
            <div
              class="text-xs text-gray-500 dark:text-gray-400 text-center py-2"
            >
              No readings
            </div>
            {% endif %}
          </div>
        </div>

        <!-- Hot Water Meter -->
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center">
              <i class="fas fa-fire text-red-500 mr-2"></i>
              <span class="font-medium text-gray-900 dark:text-white"
                >Hot Water</span
              >
            </div>
            <span
              class="inline-flex items-center px-2 py-1 rounded text-xs bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"
            >
              <i class="fas fa-circle mr-1 text-xs"></i>Active
            </span>
          </div>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-600 dark:text-gray-400">Meter ID</span>
              <span class="font-mono text-gray-900 dark:text-white"
                >{{ unit.hot_water_meter_id or '-' }}</span
              >
            </div>
            {% if meter_readings.get('hot_water') %}
            <div class="flex justify-between">
              <span class="text-gray-600 dark:text-gray-400">Reading</span>
              <span class="font-semibold text-gray-900 dark:text-white"
                >{{ meter_readings.get('hot_water').reading_value |
                format_number(2) }} kL</span
              >
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600 dark:text-gray-400">Date</span>
              <span class="text-gray-900 dark:text-white"
                >{{ meter_readings.get('hot_water').reading_date.strftime('%b
                %d, %Y') if meter_readings.get('hot_water').reading_date else
                '-' }}</span
              >
            </div>
            {% else %}
            <div
              class="text-xs text-gray-500 dark:text-gray-400 text-center py-2"
            >
              No readings
            </div>
            {% endif %}
          </div>
        </div>

        <!-- Solar Meter -->
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center">
              <i class="fas fa-solar-panel text-green-500 mr-2"></i>
              <span class="font-medium text-gray-900 dark:text-white"
                >Solar</span
              >
            </div>
            <span
              class="inline-flex items-center px-2 py-1 rounded text-xs bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"
            >
              <i class="fas fa-circle mr-1 text-xs"></i>Active
            </span>
          </div>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-600 dark:text-gray-400">Meter ID</span>
              <span class="font-mono text-gray-900 dark:text-white"
                >{{ unit.solar_meter_id or '-' }}</span
              >
            </div>
            {% if meter_readings.get('solar') %}
            <div class="flex justify-between">
              <span class="text-gray-600 dark:text-gray-400">Reading</span>
              <span class="font-semibold text-gray-900 dark:text-white"
                >{{ meter_readings.get('solar').reading_value | format_number(2)
                }} kWh</span
              >
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600 dark:text-gray-400">Date</span>
              <span class="text-gray-900 dark:text-white"
                >{{ meter_readings.get('solar').reading_date.strftime('%b %d,
                %Y') if meter_readings.get('solar').reading_date else '-'
                }}</span
              >
            </div>
            {% else %}
            <div
              class="text-xs text-gray-500 dark:text-gray-400 text-center py-2"
            >
              No readings
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
        Quick Actions
      </h3>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
        <a
          href="{{ url_for('api_v1.wallet_statement_page', unit_id=unit.id) }}"
          class="px-4 py-3 bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200 rounded-lg hover:bg-green-200 dark:hover:bg-green-900/50 text-center"
        >
          <i class="fas fa-file-invoice mb-1"></i>
          <div class="text-sm">Statement</div>
        </a>
        <a
          href="{{ url_for('api_v1.unit_visual_page', unit_id=unit.id) }}"
          class="px-4 py-3 bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 text-center"
        >
          <i class="fas fa-diagram-project mb-1"></i>
          <div class="text-sm">Visual Diagram</div>
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script></script>
{% endblock %}
