{% extends "base.html" %} {% block title %}Unit {{ unit.unit_number or unit.id
}} Visual Overview - Quantify Metering System{% endblock %} {% block page_title
%}Unit {{ unit.unit_number or unit.id }} Visual Overview{% endblock %} {% block
breadcrumb %}
<a href="{{ url_for('api_v1.dashboard') }}" class="hover:text-primary">Home</a>
<span class="mx-1">/</span>
<a href="{{ url_for('api_v1.units_page') }}" class="hover:text-primary"
  >Units</a
>
<span class="mx-1">/</span>
<a
  href="{{ url_for('api_v1.unit_details_page', unit_id=unit.id) }}"
  class="hover:text-primary"
  >Unit {{ unit.unit_number or unit.id }}</a
>
<span class="mx-1">/</span>
<span>Visual Diagram</span>
{% endblock %} {% block extra_css %}
<style>
  @keyframes flow {
    0%,
    100% {
      transform: translateX(0);
    }
    50% {
      transform: translateX(10px);
    }
  }

  @keyframes solarGlow {
    0%,
    100% {
      box-shadow: 0 0 20px rgba(251, 188, 4, 0.3);
    }
    50% {
      box-shadow: 0 0 40px rgba(251, 188, 4, 0.6);
    }
  }

  .electricity-line {
    stroke-dasharray: 5, 5;
    animation: electricity 1s linear infinite;
  }

  @keyframes electricity {
    0% {
      stroke-dashoffset: 0;
    }
    100% {
      stroke-dashoffset: -10;
    }
  }

  .water-flow {
    animation: waterFlow 2s ease-in-out infinite;
  }

  @keyframes waterFlow {
    0%,
    100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-3px);
    }
  }

  /* Dark mode text visibility for SVG - keep text dark since boxes are light */
  .diagram-text {
    fill: #374151;
  }
  .dark .diagram-text {
    fill: #1f2937; /* Dark gray for contrast with light box backgrounds */
  }

  .diagram-text-balance {
    fill: #16a34a;
  }
  .dark .diagram-text-balance {
    fill: #15803d; /* Darker green for better contrast */
  }

  .diagram-text-label {
    fill: #6b7280;
  }
  .dark .diagram-text-label {
    fill: #d1d5db; /* Light gray for visibility on dark background */
  }

  /* Ensure all SVG text with dark mode classes is visible - keep dark for light boxes */
  svg text.fill-gray-700 {
    fill: #374151;
  }
  .dark svg text.fill-gray-700 {
    fill: #1f2937; /* Dark text for light box backgrounds */
  }

  svg text.fill-gray-600 {
    fill: #4b5563;
  }
  .dark svg text.fill-gray-600 {
    fill: #374151; /* Dark text for light box backgrounds */
  }

  svg text.fill-gray-500 {
    fill: #6b7280;
  }
  .dark svg text.fill-gray-500 {
    fill: #d1d5db; /* Light gray for connection labels on dark background */
  }

  svg text.fill-green-600 {
    fill: #16a34a;
  }
  .dark svg text.fill-green-600 {
    fill: #15803d; /* Darker green for contrast */
  }
</style>
{% endblock %} {% block content %}
<!-- Visual Diagram Section -->
<div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 mb-6">
  <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6 text-center">
    Metering System Overview
  </h2>

  <!-- SVG Diagram -->
  <div class="flex justify-center">
    <svg
      width="1200"
      height="700"
      viewBox="0 0 1200 700"
      class="w-full max-w-7xl"
    >
      <!-- Grid Background -->
      <defs>
        <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
          <path
            d="M 20 0 L 0 0 0 20"
            fill="none"
            stroke="#e5e7eb"
            stroke-width="0.5"
          />
        </pattern>

        <!-- Gradient for solar panel -->
        <linearGradient id="solarGradient" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" style="stop-color: #fbbf24; stop-opacity: 1" />
          <stop offset="100%" style="stop-color: #f59e0b; stop-opacity: 1" />
        </linearGradient>

        <!-- Gradient for water -->
        <linearGradient id="waterGradient" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" style="stop-color: #60a5fa; stop-opacity: 1" />
          <stop offset="100%" style="stop-color: #3b82f6; stop-opacity: 1" />
        </linearGradient>
      </defs>

      <rect width="1200" height="700" fill="url(#grid)" />

      <!-- House -->
      <g transform="translate(600, 350)">
        <!-- House base -->
        <rect
          x="-50"
          y="0"
          width="100"
          height="80"
          fill="#94a3b8"
          stroke="#64748b"
          stroke-width="2"
        />
        <!-- Roof -->
        <polygon
          points="-60,-40 0,-70 60,-40"
          fill="#ef4444"
          stroke="#dc2626"
          stroke-width="2"
        />
        <!-- Door -->
        <rect
          x="-15"
          y="40"
          width="30"
          height="40"
          fill="#7c3aed"
          stroke="#6d28d9"
          stroke-width="2"
        />
        <!-- Windows -->
        <rect
          x="-35"
          y="15"
          width="25"
          height="20"
          fill="#60a5fa"
          stroke="#3b82f6"
          stroke-width="2"
        />
        <rect
          x="10"
          y="15"
          width="25"
          height="20"
          fill="#60a5fa"
          stroke="#3b82f6"
          stroke-width="2"
        />
        <!-- House Label -->
        <text
          x="0"
          y="100"
          text-anchor="middle"
          class="fill-gray-700 dark:fill-gray-300 font-semibold text-sm"
        >
          Unit {{ unit.unit_number or unit.id }}
        </text>
      </g>

      <!-- Solar Panel Array -->
      <g transform="translate(600, 80)">
        <rect
          x="-80"
          y="-25"
          width="160"
          height="50"
          fill="url(#solarGradient)"
          stroke="#f59e0b"
          stroke-width="2"
          rx="5"
          class="animate-solar-glow"
        />
        <line
          x1="-60"
          y1="-25"
          x2="-60"
          y2="25"
          stroke="#92400e"
          stroke-width="1"
        />
        <line
          x1="-40"
          y1="-25"
          x2="-40"
          y2="25"
          stroke="#92400e"
          stroke-width="1"
        />
        <line
          x1="-20"
          y1="-25"
          x2="-20"
          y2="25"
          stroke="#92400e"
          stroke-width="1"
        />
        <line
          x1="0"
          y1="-25"
          x2="0"
          y2="25"
          stroke="#92400e"
          stroke-width="1"
        />
        <line
          x1="20"
          y1="-25"
          x2="20"
          y2="25"
          stroke="#92400e"
          stroke-width="1"
        />
        <line
          x1="40"
          y1="-25"
          x2="40"
          y2="25"
          stroke="#92400e"
          stroke-width="1"
        />
        <line
          x1="60"
          y1="-25"
          x2="60"
          y2="25"
          stroke="#92400e"
          stroke-width="1"
        />
        <text
          x="0"
          y="-35"
          text-anchor="middle"
          class="diagram-text font-bold text-xs"
        >
          SOLAR GENERATION
        </text>
        <circle cx="0" cy="0" r="3" fill="#fbbf24" class="animate-pulse" />
      </g>

      <!-- Solar Meter -->
      <g transform="translate(450, 140)">
        <rect
          x="-50"
          y="-30"
          width="100"
          height="60"
          fill="#fef3c7"
          stroke="#fbbf24"
          stroke-width="2"
          rx="5"
        />
        <text
          x="0"
          y="-10"
          text-anchor="middle"
          class="diagram-text font-bold text-xs"
        >
          SOLAR E460
        </text>
        <text
          x="0"
          y="5"
          text-anchor="middle"
          class="diagram-text font-mono text-xs"
        >
          {{ solar_serial or 'N/A' }}
        </text>
        <circle cx="35" cy="-20" r="3" fill="#10b981" class="animate-pulse" />
      </g>

      <!-- Eskom Supply -->
      <g transform="translate(180, 300)">
        <rect
          x="-70"
          y="-30"
          width="140"
          height="60"
          fill="#fee2e2"
          stroke="#ef4444"
          stroke-width="2"
          rx="5"
        />
        <text
          x="0"
          y="-8"
          text-anchor="middle"
          class="diagram-text font-bold text-xs"
        >
          ESKOM GRID
        </text>
        <text x="0" y="8" text-anchor="middle" class="diagram-text text-xs">
          {{ elec_rate_name[:30] if elec_rate_name else 'Standard Residential'
          }}
        </text>
      </g>

      <!-- Electricity Meter -->
      <g transform="translate(350, 300)">
        <rect
          x="-50"
          y="-30"
          width="100"
          height="60"
          fill="#fee2e2"
          stroke="#ef4444"
          stroke-width="2"
          rx="5"
        />
        <text
          x="0"
          y="-10"
          text-anchor="middle"
          class="diagram-text font-bold text-xs"
        >
          ELEC E460
        </text>
        <text
          x="0"
          y="5"
          text-anchor="middle"
          class="diagram-text font-mono text-xs"
        >
          {{ elec_serial or 'N/A' }}
        </text>
        <circle cx="35" cy="-20" r="3" fill="#10b981" class="animate-pulse" />
      </g>

      <!-- Water Supply -->
      <g transform="translate(180, 450)">
        <rect
          x="-70"
          y="-30"
          width="140"
          height="60"
          fill="#dbeafe"
          stroke="#3b82f6"
          stroke-width="2"
          rx="5"
        />
        <text
          x="0"
          y="-8"
          text-anchor="middle"
          class="diagram-text font-bold text-xs"
        >
          WATER MAIN
        </text>
        <text x="0" y="8" text-anchor="middle" class="diagram-text text-xs">
          {{ water_rate_name[:30] if water_rate_name else 'Standard Residential
          Water' }}
        </text>
      </g>

      <!-- Water Meter -->
      <g transform="translate(350, 450)">
        <rect
          x="-50"
          y="-30"
          width="100"
          height="60"
          fill="#dbeafe"
          stroke="#3b82f6"
          stroke-width="2"
          rx="5"
        />
        <text
          x="0"
          y="-10"
          text-anchor="middle"
          class="diagram-text font-bold text-xs"
        >
          WATER DC450
        </text>
        <text
          x="0"
          y="5"
          text-anchor="middle"
          class="diagram-text font-mono text-xs"
        >
          {{ water_serial or 'N/A' }}
        </text>
        <circle cx="35" cy="-20" r="3" fill="#10b981" class="animate-pulse" />
      </g>

      <!-- Hot Water Supply -->
      <g transform="translate(180, 580)">
        <rect
          x="-70"
          y="-30"
          width="140"
          height="60"
          fill="#ffedd5"
          stroke="#f97316"
          stroke-width="2"
          rx="5"
        />
        <text
          x="0"
          y="-8"
          text-anchor="middle"
          class="diagram-text font-bold text-xs"
        >
          HOT WATER
        </text>
        <text x="0" y="8" text-anchor="middle" class="diagram-text text-xs">
          Hot Water Supply
        </text>
      </g>

      <!-- Hot Water Meter -->
      <g transform="translate(350, 580)">
        <rect
          x="-50"
          y="-30"
          width="100"
          height="60"
          fill="#ffedd5"
          stroke="#f97316"
          stroke-width="2"
          rx="5"
        />
        <text
          x="0"
          y="-10"
          text-anchor="middle"
          class="diagram-text font-bold text-xs"
        >
          HOT WATER
        </text>
        <text
          x="0"
          y="5"
          text-anchor="middle"
          class="diagram-text font-mono text-xs"
        >
          {{ hot_water_serial or 'N/A' }}
        </text>
        <circle cx="35" cy="-20" r="3" fill="#10b981" class="animate-pulse" />
      </g>

      <!-- Prepaid Wallet -->
      <g transform="translate(950, 280)">
        <rect
          x="-60"
          y="-50"
          width="120"
          height="100"
          fill="#f0fdf4"
          stroke="#22c55e"
          stroke-width="2"
          rx="10"
          class="dark:fill-gray-700 dark:stroke-green-500"
        />
        <text
          x="0"
          y="-25"
          text-anchor="middle"
          class="diagram-text font-bold text-xs"
        >
          WALLET
        </text>
        <text
          x="0"
          y="-5"
          text-anchor="middle"
          class="diagram-text-balance font-bold text-sm"
        >
          R {{ (wallet.balance if wallet else 0) | format_number(2) }}
        </text>
        <text x="0" y="15" text-anchor="middle" class="diagram-text text-xs">
          Balance
        </text>
        <rect
          x="-40"
          y="25"
          width="80"
          height="10"
          fill="#e5e7eb"
          rx="4"
          class="dark:fill-gray-600"
        />
        <rect
          x="-40"
          y="25"
          width="60"
          height="10"
          fill="#22c55e"
          rx="4"
          class="dark:fill-green-500"
        />
      </g>

      <!-- Data Concentrator -->
      <g transform="translate(950, 80)">
        <rect
          x="-60"
          y="-35"
          width="120"
          height="70"
          fill="#f3f4f6"
          stroke="#6b7280"
          stroke-width="2"
          rx="5"
        />
        <text
          x="0"
          y="-15"
          text-anchor="middle"
          class="diagram-text font-bold text-xs"
        >
          DC450
        </text>
        <text x="0" y="0" text-anchor="middle" class="diagram-text text-xs">
          PLC Hub
        </text>
        <text
          x="0"
          y="15"
          text-anchor="middle"
          class="diagram-text font-mono text-xs"
        >
          DC-0014
        </text>
        <circle cx="45" cy="-25" r="3" fill="#10b981" class="animate-pulse" />
      </g>

      <!-- Connection Lines -->
      <!-- Solar Generation to Solar Meter -->
      <line
        x1="520"
        y1="80"
        x2="400"
        y2="140"
        stroke="#fbbf24"
        stroke-width="3"
        stroke-dasharray="5,5"
        class="electricity-line"
      />

      <!-- Solar Meter to House -->
      <line
        x1="400"
        y1="170"
        x2="550"
        y2="350"
        stroke="#fbbf24"
        stroke-width="3"
        stroke-dasharray="5,5"
        class="electricity-line"
      />
      <text x="420" y="250" class="diagram-text-label text-xs">
        50 kWh free
      </text>

      <!-- Eskom to Electricity Meter -->
      <line
        x1="250"
        y1="300"
        x2="300"
        y2="300"
        stroke="#ef4444"
        stroke-width="3"
      />

      <!-- Electricity Meter to House -->
      <line
        x1="400"
        y1="300"
        x2="550"
        y2="350"
        stroke="#ef4444"
        stroke-width="3"
        stroke-dasharray="5,5"
        class="electricity-line"
      />
      <text x="450" y="310" class="diagram-text-label text-xs">Prepaid</text>

      <!-- Water Main to Water Meter -->
      <line
        x1="250"
        y1="450"
        x2="300"
        y2="450"
        stroke="#3b82f6"
        stroke-width="3"
      />

      <!-- Water Meter to House -->
      <path
        d="M 400 450 Q 500 400 550 390"
        fill="none"
        stroke="#3b82f6"
        stroke-width="3"
        stroke-dasharray="5,5"
        class="water-flow"
      />
      <text x="470" y="410" class="diagram-text-label text-xs">Monitored</text>

      <!-- Hot Water to Hot Water Meter -->
      <line
        x1="250"
        y1="580"
        x2="300"
        y2="580"
        stroke="#f97316"
        stroke-width="3"
      />

      <!-- Hot Water Meter to House -->
      <path
        d="M 400 580 Q 520 500 560 410"
        fill="none"
        stroke="#f97316"
        stroke-width="3"
        stroke-dasharray="5,5"
        class="electricity-line"
      />

      <!-- House to Wallet -->
      <line
        x1="650"
        y1="350"
        x2="890"
        y2="230"
        stroke="#22c55e"
        stroke-width="2"
        stroke-dasharray="3,3"
      />
      <text x="750" y="280" class="diagram-text-label text-xs">Deducts</text>

      <!-- Meters to Data Concentrator (PLC) -->
      <path
        d="M 400 140 Q 700 100 890 80"
        fill="none"
        stroke="#9ca3af"
        stroke-width="1"
        stroke-dasharray="2,2"
      />
      <path
        d="M 400 300 Q 700 180 890 80"
        fill="none"
        stroke="#9ca3af"
        stroke-width="1"
        stroke-dasharray="2,2"
      />
      <path
        d="M 400 450 Q 700 250 890 80"
        fill="none"
        stroke="#9ca3af"
        stroke-width="1"
        stroke-dasharray="2,2"
      />
      <path
        d="M 400 580 Q 700 300 890 80"
        fill="none"
        stroke="#9ca3af"
        stroke-width="1"
        stroke-dasharray="2,2"
      />
      <text x="750" y="70" class="diagram-text-label text-xs">PLC Comms</text>
    </svg>
  </div>
</div>

<!-- Info Cards Grid -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
  <!-- Resident Information -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
    <div class="flex items-center mb-4">
      <i class="fas fa-user-circle text-3xl text-primary mr-3"></i>
      <h3 class="text-lg font-bold text-gray-900 dark:text-white">
        Resident Details
      </h3>
    </div>
    <div class="space-y-3">
      {% if resident %}
      <div>
        <p class="text-xs text-gray-500 dark:text-gray-400">Name</p>
        <p class="text-sm font-semibold text-gray-900 dark:text-white">
          {{ resident.first_name }} {{ resident.last_name }}
        </p>
      </div>
      <div>
        <p class="text-xs text-gray-500 dark:text-gray-400">Contact</p>
        <p class="text-sm text-gray-900 dark:text-white">
          {{ resident.phone or '-' }}
        </p>
      </div>
      <div>
        <p class="text-xs text-gray-500 dark:text-gray-400">Email</p>
        <p class="text-sm text-gray-900 dark:text-white">
          {{ resident.email or '-' }}
        </p>
      </div>
      {% if resident.lease_start_date %}
      <div>
        <p class="text-xs text-gray-500 dark:text-gray-400">Lease Start</p>
        <p class="text-sm text-gray-900 dark:text-white">
          {{ resident.lease_start_date.strftime('%d %B %Y') }}
        </p>
      </div>
      {% endif %} {% else %}
      <p class="text-sm text-gray-500 dark:text-gray-400">
        No resident assigned
      </p>
      {% endif %}
    </div>
  </div>

  <!-- Today's Usage -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
    <div class="flex items-center mb-4">
      <i class="fas fa-calendar-day text-3xl text-purple-500 mr-3"></i>
      <h3 class="text-lg font-bold text-gray-900 dark:text-white">
        Today's Usage
      </h3>
    </div>
    <div class="space-y-3">
      <div class="flex justify-between items-center">
        <span class="text-sm text-gray-600 dark:text-gray-400"
          >Electricity</span
        >
        <span class="text-sm font-bold text-gray-900 dark:text-white">
          {{ today_usage.electricity | format_number(2) }} kWh
        </span>
      </div>
      <div class="flex justify-between items-center">
        <span class="text-sm text-gray-600 dark:text-gray-400">Solar</span>
        <span class="text-sm font-bold text-yellow-600">
          {{ today_usage.solar | format_number(2) }} kWh
        </span>
      </div>
      <div class="flex justify-between items-center">
        <span class="text-sm text-gray-600 dark:text-gray-400">Water</span>
        <span class="text-sm font-bold text-blue-600">
          {{ (today_usage.water * 1000) | format_number(0) }} L
        </span>
      </div>
      <div class="flex justify-between items-center pt-3 border-t">
        <span class="text-sm text-gray-600 dark:text-gray-400">Hot Water</span>
        <span class="text-sm font-bold text-orange-600">
          {{ (today_usage.hot_water * 1000) | format_number(0) }} L
        </span>
      </div>
    </div>
  </div>
</div>

<!-- Meter Details -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
  {% if solar_meter_details %}
  <!-- Solar Meter -->
  <div
    class="bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-xl shadow-lg p-6 border border-yellow-200 dark:border-yellow-700"
  >
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center">
        <i class="fas fa-solar-panel text-2xl text-yellow-600 mr-3"></i>
        <h4 class="font-bold text-gray-900 dark:text-white">Solar Meter</h4>
      </div>
      <span
        class="px-2 py-1 {% if solar_meter_details.communication_status == 'online' %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %} text-xs rounded-full"
      >
        {{ solar_meter_details.communication_status.title() }}
      </span>
    </div>
    <div class="space-y-2 text-sm">
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Meter ID:</span>
        <span class="font-mono font-bold text-gray-900 dark:text-gray-300"
          >{{ solar_meter_details.serial_number }}</span
        >
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Type:</span>
        <span class="text-gray-900 dark:text-gray-300"
          >{{ solar_meter_details.type }}</span
        >
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Total Generated:</span>
        <span class="font-bold text-gray-900 dark:text-gray-300"
          >{{ solar_meter_details.total_generated | format_number(2) }}
          kWh</span
        >
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Free Remaining:</span>
        <span class="font-bold text-yellow-600 dark:text-yellow-400"
          >{{ solar_meter_details.free_remaining | format_number(2) }} kWh</span
        >
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Last Reading:</span>
        <span class="text-xs text-gray-900 dark:text-gray-300"
          >{{ solar_meter_details.last_reading_ago }}</span
        >
      </div>
    </div>
  </div>
  {% endif %} {% if elec_meter_details %}
  <!-- Electricity Meter -->
  <div
    class="bg-gradient-to-br from-red-50 to-pink-50 dark:from-red-900/20 dark:to-pink-900/20 rounded-xl shadow-lg p-6 border border-red-200 dark:border-red-700"
  >
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center">
        <i class="fas fa-bolt text-2xl text-red-600 mr-3"></i>
        <h4 class="font-bold text-gray-900 dark:text-white">
          Electricity Meter
        </h4>
      </div>
      <span
        class="px-2 py-1 {% if elec_meter_details.communication_status == 'online' %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %} text-xs rounded-full"
      >
        {{ elec_meter_details.communication_status.title() }}
      </span>
    </div>
    <div class="space-y-2 text-sm">
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Meter ID:</span>
        <span class="font-mono font-bold text-gray-900 dark:text-gray-300"
          >{{ elec_meter_details.serial_number }}</span
        >
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Type:</span>
        <span class="text-gray-900 dark:text-gray-300"
          >{{ elec_meter_details.type }}</span
        >
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Total Usage:</span>
        <span class="font-bold text-gray-900 dark:text-gray-300"
          >{{ elec_meter_details.total_usage | format_number(2) }} kWh</span
        >
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Supply Status:</span>
        <span
          class="font-bold {% if elec_meter_details.supply_status == 'Connected' %}text-green-600 dark:text-green-400{% else %}text-red-600 dark:text-red-400{% endif %}"
        >
          {{ elec_meter_details.supply_status }}
        </span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Last Reading:</span>
        <span class="text-xs text-gray-900 dark:text-gray-300"
          >{{ elec_meter_details.last_reading_ago }}</span
        >
      </div>
    </div>
  </div>
  {% endif %} {% if water_meter_details %}
  <!-- Water Meter -->
  <div
    class="bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl shadow-lg p-6 border border-blue-200 dark:border-blue-700"
  >
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center">
        <i class="fas fa-tint text-2xl text-blue-600 mr-3"></i>
        <h4 class="font-bold text-gray-900 dark:text-white">Water Meter</h4>
      </div>
      <span
        class="px-2 py-1 {% if water_meter_details.communication_status == 'online' %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %} text-xs rounded-full"
      >
        {{ water_meter_details.communication_status.title() }}
      </span>
    </div>
    <div class="space-y-2 text-sm">
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Meter ID:</span>
        <span class="font-mono font-bold text-gray-900 dark:text-gray-300"
          >{{ water_meter_details.serial_number }}</span
        >
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Type:</span>
        <span class="text-gray-900 dark:text-gray-300"
          >{{ water_meter_details.type }}</span
        >
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Total Usage:</span>
        <span class="font-bold text-gray-900 dark:text-gray-300"
          >{{ (water_meter_details.total_usage * 1000) | format_number(0) }}
          L</span
        >
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Flow Status:</span>
        <span
          class="font-bold {% if water_meter_details.communication_status == 'online' %}text-blue-600 dark:text-blue-400{% else %}text-gray-600 dark:text-gray-400{% endif %}"
        >
          {% if water_meter_details.communication_status == 'online' %}Active{%
          else %}Inactive{% endif %}
        </span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Last Reading:</span>
        <span class="text-xs text-gray-900 dark:text-gray-300"
          >{{ water_meter_details.last_reading_ago }}</span
        >
      </div>
    </div>
  </div>
  {% endif %} {% if hot_water_meter_details %}
  <!-- Hot Water Meter -->
  <div
    class="bg-gradient-to-br from-orange-50 to-amber-50 dark:from-orange-900/20 dark:to-amber-900/20 rounded-xl shadow-lg p-6 border border-orange-200 dark:border-orange-700"
  >
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center">
        <i class="fas fa-fire text-2xl text-orange-600 mr-3"></i>
        <h4 class="font-bold text-gray-900 dark:text-white">Hot Water Meter</h4>
      </div>
      <span
        class="px-2 py-1 {% if hot_water_meter_details.communication_status == 'online' %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %} text-xs rounded-full"
      >
        {{ hot_water_meter_details.communication_status.title() }}
      </span>
    </div>
    <div class="space-y-2 text-sm">
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Meter ID:</span>
        <span class="font-mono font-bold text-gray-900 dark:text-gray-300"
          >{{ hot_water_meter_details.serial_number }}</span
        >
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Type:</span>
        <span class="text-gray-900 dark:text-gray-300"
          >{{ hot_water_meter_details.type }}</span
        >
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Total Usage:</span>
        <span class="font-bold text-gray-900 dark:text-gray-300"
          >{{ (hot_water_meter_details.total_usage * 1000) | format_number(0) }}
          L</span
        >
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Flow Status:</span>
        <span
          class="font-bold {% if hot_water_meter_details.communication_status == 'online' %}text-orange-600 dark:text-orange-400{% else %}text-gray-600 dark:text-gray-400{% endif %}"
        >
          {% if hot_water_meter_details.communication_status == 'online'
          %}Active{% else %}Inactive{% endif %}
        </span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Last Reading:</span>
        <span class="text-xs text-gray-900 dark:text-gray-300"
          >{{ hot_water_meter_details.last_reading_ago }}</span
        >
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
