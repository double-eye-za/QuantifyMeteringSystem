{% extends "base.html" %} {% block title %}Unit A-101 Visual Overview - Quantify
Metering System{% endblock %} {% block page_title %}Unit A-101 Visual Overview{%
endblock %} {% block breadcrumb %}
<a href="{{ url_for('api_v1.dashboard') }}" class="hover:text-primary">Home</a>
<span class="mx-1">/</span>
<a href="{{ url_for('api_v1.units_page') }}" class="hover:text-primary"
  >Units</a
>
<span class="mx-1">/</span>
<a
  href="{{ url_for('api_v1.unit_details_page', unit_id='A-101') }}"
  class="hover:text-primary"
  >Unit A-101</a
>
<span class="mx-1">/</span>
<span>Visual Diagram</span>
{% endblock %} {% block extra_css %}
<style>
  @keyframes flow {
    0%,
    100% {
      transform: translateX(0);
    }
    50% {
      transform: translateX(10px);
    }
  }

  @keyframes solarGlow {
    0%,
    100% {
      box-shadow: 0 0 20px rgba(251, 188, 4, 0.3);
    }
    50% {
      box-shadow: 0 0 40px rgba(251, 188, 4, 0.6);
    }
  }

  .electricity-line {
    stroke-dasharray: 5, 5;
    animation: electricity 1s linear infinite;
  }

  @keyframes electricity {
    0% {
      stroke-dashoffset: 0;
    }
    100% {
      stroke-dashoffset: -10;
    }
  }

  .water-flow {
    animation: waterFlow 2s ease-in-out infinite;
  }

  @keyframes waterFlow {
    0%,
    100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-3px);
    }
  }
</style>
{% endblock %} {% block content %}
<!-- Visual Diagram Section -->
<div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 mb-6">
  <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6 text-center">
    Metering System Overview
  </h2>

  <!-- SVG Diagram -->
  <div class="flex justify-center">
    <svg
      width="800"
      height="500"
      viewBox="0 0 800 500"
      class="w-full max-w-4xl"
    >
      <!-- Grid Background -->
      <defs>
        <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
          <path
            d="M 20 0 L 0 0 0 20"
            fill="none"
            stroke="#e5e7eb"
            stroke-width="0.5"
          />
        </pattern>

        <!-- Gradient for solar panel -->
        <linearGradient id="solarGradient" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" style="stop-color: #fbbf24; stop-opacity: 1" />
          <stop offset="100%" style="stop-color: #f59e0b; stop-opacity: 1" />
        </linearGradient>

        <!-- Gradient for water -->
        <linearGradient id="waterGradient" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" style="stop-color: #60a5fa; stop-opacity: 1" />
          <stop offset="100%" style="stop-color: #3b82f6; stop-opacity: 1" />
        </linearGradient>
      </defs>

      <rect width="800" height="500" fill="url(#grid)" />

      <!-- House -->
      <g transform="translate(350, 200)">
        <!-- House base -->
        <rect
          x="-50"
          y="0"
          width="100"
          height="80"
          fill="#94a3b8"
          stroke="#64748b"
          stroke-width="2"
        />
        <!-- Roof -->
        <polygon
          points="-60,-40 0,-70 60,-40"
          fill="#ef4444"
          stroke="#dc2626"
          stroke-width="2"
        />
        <!-- Door -->
        <rect
          x="-15"
          y="40"
          width="30"
          height="40"
          fill="#7c3aed"
          stroke="#6d28d9"
          stroke-width="2"
        />
        <!-- Windows -->
        <rect
          x="-35"
          y="15"
          width="25"
          height="20"
          fill="#60a5fa"
          stroke="#3b82f6"
          stroke-width="2"
        />
        <rect
          x="10"
          y="15"
          width="25"
          height="20"
          fill="#60a5fa"
          stroke="#3b82f6"
          stroke-width="2"
        />
        <!-- House Label -->
        <text
          x="0"
          y="100"
          text-anchor="middle"
          class="fill-gray-700 dark:fill-gray-300 font-semibold text-sm"
        >
          Unit A-101
        </text>
      </g>

      <!-- Solar Panel Array -->
      <g transform="translate(350, 50)">
        <rect
          x="-60"
          y="-20"
          width="120"
          height="40"
          fill="url(#solarGradient)"
          stroke="#f59e0b"
          stroke-width="2"
          rx="5"
          class="animate-solar-glow"
        />
        <line
          x1="-50"
          y1="-20"
          x2="-50"
          y2="20"
          stroke="#92400e"
          stroke-width="1"
        />
        <line
          x1="-30"
          y1="-20"
          x2="-30"
          y2="20"
          stroke="#92400e"
          stroke-width="1"
        />
        <line
          x1="-10"
          y1="-20"
          x2="-10"
          y2="20"
          stroke="#92400e"
          stroke-width="1"
        />
        <line
          x1="10"
          y1="-20"
          x2="10"
          y2="20"
          stroke="#92400e"
          stroke-width="1"
        />
        <line
          x1="30"
          y1="-20"
          x2="30"
          y2="20"
          stroke="#92400e"
          stroke-width="1"
        />
        <line
          x1="50"
          y1="-20"
          x2="50"
          y2="20"
          stroke="#92400e"
          stroke-width="1"
        />
        <text
          x="0"
          y="-30"
          text-anchor="middle"
          class="fill-gray-700 dark:fill-gray-300 font-bold text-xs"
        >
          SOLAR GENERATION
        </text>
        <circle cx="0" cy="0" r="3" fill="#fbbf24" class="animate-pulse" />
      </g>

      <!-- Solar Meter -->
      <g transform="translate(200, 100)">
        <rect
          x="-30"
          y="-25"
          width="60"
          height="50"
          fill="#fef3c7"
          stroke="#fbbf24"
          stroke-width="2"
          rx="5"
        />
        <text
          x="0"
          y="-5"
          text-anchor="middle"
          class="fill-gray-700 font-bold text-xs"
        >
          SOLAR
        </text>
        <text x="0" y="8" text-anchor="middle" class="fill-gray-600 text-xs">
          E460
        </text>
        <text
          x="0"
          y="20"
          text-anchor="middle"
          class="fill-gray-800 font-mono text-xs"
        >
          SM-78432
        </text>
        <circle cx="20" cy="-15" r="3" fill="#10b981" class="animate-pulse" />
      </g>

      <!-- Eskom Supply -->
      <g transform="translate(100, 250)">
        <rect
          x="-40"
          y="-20"
          width="80"
          height="40"
          fill="#fee2e2"
          stroke="#ef4444"
          stroke-width="2"
          rx="5"
        />
        <text
          x="0"
          y="0"
          text-anchor="middle"
          class="fill-gray-700 dark:fill-gray-300 font-bold text-xs"
        >
          ESKOM GRID
        </text>
        <text
          x="0"
          y="15"
          text-anchor="middle"
          class="fill-gray-600 dark:fill-gray-400 text-xs"
        >
          230V Supply
        </text>
      </g>

      <!-- Electricity Meter -->
      <g transform="translate(200, 250)">
        <rect
          x="-30"
          y="-25"
          width="60"
          height="50"
          fill="#fee2e2"
          stroke="#ef4444"
          stroke-width="2"
          rx="5"
        />
        <text
          x="0"
          y="-5"
          text-anchor="middle"
          class="fill-gray-700 font-bold text-xs"
        >
          ELEC
        </text>
        <text x="0" y="8" text-anchor="middle" class="fill-gray-600 text-xs">
          E460
        </text>
        <text
          x="0"
          y="20"
          text-anchor="middle"
          class="fill-gray-800 font-mono text-xs"
        >
          EM-45621
        </text>
        <circle cx="20" cy="-15" r="3" fill="#10b981" class="animate-pulse" />
      </g>

      <!-- Water Supply -->
      <g transform="translate(100, 380)">
        <rect
          x="-40"
          y="-20"
          width="80"
          height="40"
          fill="#dbeafe"
          stroke="#3b82f6"
          stroke-width="2"
          rx="5"
        />
        <text
          x="0"
          y="0"
          text-anchor="middle"
          class="fill-gray-700 dark:fill-gray-300 font-bold text-xs"
        >
          WATER MAIN
        </text>
        <text
          x="0"
          y="15"
          text-anchor="middle"
          class="fill-gray-600 dark:fill-gray-400 text-xs"
        >
          Municipal
        </text>
      </g>

      <!-- Water Meter -->
      <g transform="translate(200, 380)">
        <rect
          x="-30"
          y="-25"
          width="60"
          height="50"
          fill="#dbeafe"
          stroke="#3b82f6"
          stroke-width="2"
          rx="5"
        />
        <text
          x="0"
          y="-5"
          text-anchor="middle"
          class="fill-gray-700 font-bold text-xs"
        >
          WATER
        </text>
        <text x="0" y="8" text-anchor="middle" class="fill-gray-600 text-xs">
          DC450
        </text>
        <text
          x="0"
          y="20"
          text-anchor="middle"
          class="fill-gray-800 font-mono text-xs"
        >
          WM-12987
        </text>
        <circle cx="20" cy="-15" r="3" fill="#10b981" class="animate-pulse" />
      </g>

      <!-- Prepaid Wallet -->
      <g transform="translate(550, 250)">
        <rect
          x="-40"
          y="-40"
          width="80"
          height="80"
          fill="#f0fdf4"
          stroke="#22c55e"
          stroke-width="2"
          rx="10"
        />
        <text
          x="0"
          y="-20"
          text-anchor="middle"
          class="fill-gray-700 font-bold text-xs"
        >
          WALLET
        </text>
        <text
          x="0"
          y="0"
          text-anchor="middle"
          class="fill-green-600 font-bold text-lg"
        >
          R 450.00
        </text>
        <text x="0" y="15" text-anchor="middle" class="fill-gray-600 text-xs">
          Balance
        </text>
        <rect x="-30" y="20" width="60" height="8" fill="#e5e7eb" rx="4" />
        <rect x="-30" y="20" width="45" height="8" fill="#22c55e" rx="4" />
      </g>

      <!-- Data Concentrator -->
      <g transform="translate(650, 100)">
        <rect
          x="-35"
          y="-25"
          width="70"
          height="50"
          fill="#f3f4f6"
          stroke="#6b7280"
          stroke-width="2"
          rx="5"
        />
        <text
          x="0"
          y="-5"
          text-anchor="middle"
          class="fill-gray-700 font-bold text-xs"
        >
          DC450
        </text>
        <text x="0" y="8" text-anchor="middle" class="fill-gray-600 text-xs">
          PLC Hub
        </text>
        <text
          x="0"
          y="20"
          text-anchor="middle"
          class="fill-gray-500 font-mono text-xs"
        >
          DC-0014
        </text>
        <circle cx="25" cy="-15" r="3" fill="#10b981" class="animate-pulse" />
      </g>

      <!-- Connection Lines -->
      <!-- Solar to Solar Meter -->
      <line
        x1="350"
        y1="70"
        x2="230"
        y2="100"
        stroke="#fbbf24"
        stroke-width="3"
        stroke-dasharray="5,5"
        class="electricity-line"
      />

      <!-- Solar Meter to House -->
      <line
        x1="230"
        y1="125"
        x2="300"
        y2="200"
        stroke="#fbbf24"
        stroke-width="3"
        stroke-dasharray="5,5"
        class="electricity-line"
      />

      <!-- Eskom to Electricity Meter -->
      <line
        x1="140"
        y1="250"
        x2="170"
        y2="250"
        stroke="#ef4444"
        stroke-width="3"
      />

      <!-- Electricity Meter to House -->
      <line
        x1="230"
        y1="250"
        x2="300"
        y2="250"
        stroke="#ef4444"
        stroke-width="3"
        stroke-dasharray="5,5"
        class="electricity-line"
      />

      <!-- Water to Water Meter -->
      <line
        x1="140"
        y1="380"
        x2="170"
        y2="380"
        stroke="#3b82f6"
        stroke-width="3"
      />

      <!-- Water Meter to House -->
      <path
        d="M 230 380 Q 280 380 300 280"
        fill="none"
        stroke="#3b82f6"
        stroke-width="3"
        stroke-dasharray="5,5"
        class="water-flow"
      />

      <!-- House to Wallet -->
      <line
        x1="400"
        y1="250"
        x2="510"
        y2="250"
        stroke="#22c55e"
        stroke-width="2"
        stroke-dasharray="3,3"
      />

      <!-- Meters to Data Concentrator (PLC) -->
      <path
        d="M 230 100 Q 400 50 615 100"
        fill="none"
        stroke="#9ca3af"
        stroke-width="1"
        stroke-dasharray="2,2"
      />
      <path
        d="M 230 250 Q 400 150 615 100"
        fill="none"
        stroke="#9ca3af"
        stroke-width="1"
        stroke-dasharray="2,2"
      />
      <path
        d="M 230 380 Q 400 200 615 100"
        fill="none"
        stroke="#9ca3af"
        stroke-width="1"
        stroke-dasharray="2,2"
      />

      <!-- Labels for connections -->
      <text x="250" y="90" class="fill-gray-500 text-xs">50 kWh free</text>
      <text x="250" y="240" class="fill-gray-500 text-xs">Prepaid</text>
      <text x="250" y="390" class="fill-gray-500 text-xs">Monitored</text>
      <text x="450" y="240" class="fill-gray-500 text-xs">Deducts</text>
      <text x="500" y="80" class="fill-gray-500 text-xs">PLC Comms</text>
    </svg>
  </div>
</div>

<!-- Info Cards Grid -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
  <!-- Resident Information -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
    <div class="flex items-center mb-4">
      <i class="fas fa-user-circle text-3xl text-primary mr-3"></i>
      <h3 class="text-lg font-bold text-gray-900 dark:text-white">
        Resident Details
      </h3>
    </div>
    <div class="space-y-3">
      <div>
        <p class="text-xs text-gray-500 dark:text-gray-400">Name</p>
        <p class="text-sm font-semibold text-gray-900 dark:text-white">
          John Smith
        </p>
      </div>
      <div>
        <p class="text-xs text-gray-500 dark:text-gray-400">Contact</p>
        <p class="text-sm text-gray-900 dark:text-white">+27 82 123 4567</p>
      </div>
      <div>
        <p class="text-xs text-gray-500 dark:text-gray-400">Email</p>
        <p class="text-sm text-gray-900 dark:text-white">
          john.smith@email.com
        </p>
      </div>
      <div>
        <p class="text-xs text-gray-500 dark:text-gray-400">Lease Start</p>
        <p class="text-sm text-gray-900 dark:text-white">01 March 2023</p>
      </div>
    </div>
  </div>

  <!-- Current Consumption -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
    <div class="flex items-center mb-4">
      <i class="fas fa-chart-line text-3xl text-green-500 mr-3"></i>
      <h3 class="text-lg font-bold text-gray-900 dark:text-white">
        Live Consumption
      </h3>
    </div>
    <div class="space-y-3">
      <div class="flex justify-between items-center">
        <span class="text-sm text-gray-600 dark:text-gray-400"
          >Electricity</span
        >
        <span class="text-sm font-bold text-gray-900 dark:text-white"
          >2.3 kW</span
        >
      </div>
      <div class="flex justify-between items-center">
        <span class="text-sm text-gray-600 dark:text-gray-400"
          >Solar Generation</span
        >
        <span class="text-sm font-bold text-yellow-600">1.8 kW</span>
      </div>
      <div class="flex justify-between items-center">
        <span class="text-sm text-gray-600 dark:text-gray-400">Grid Draw</span>
        <span class="text-sm font-bold text-red-600">0.5 kW</span>
      </div>
      <div class="flex justify-between items-center pt-3 border-t">
        <span class="text-sm text-gray-600 dark:text-gray-400">Water Flow</span>
        <span class="text-sm font-bold text-blue-600">12 L/min</span>
      </div>
    </div>
  </div>

  <!-- Today's Usage -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
    <div class="flex items-center mb-4">
      <i class="fas fa-calendar-day text-3xl text-purple-500 mr-3"></i>
      <h3 class="text-lg font-bold text-gray-900 dark:text-white">
        Today's Usage
      </h3>
    </div>
    <div class="space-y-3">
      <div class="flex justify-between items-center">
        <span class="text-sm text-gray-600 dark:text-gray-400"
          >Electricity</span
        >
        <span class="text-sm font-bold text-gray-900 dark:text-white"
          >18.5 kWh</span
        >
      </div>
      <div class="flex justify-between items-center">
        <span class="text-sm text-gray-600 dark:text-gray-400">Solar Used</span>
        <span class="text-sm font-bold text-yellow-600">12.0 kWh</span>
      </div>
      <div class="flex justify-between items-center">
        <span class="text-sm text-gray-600 dark:text-gray-400">Grid Used</span>
        <span class="text-sm font-bold text-red-600">6.5 kWh</span>
      </div>
      <div class="flex justify-between items-center pt-3 border-t">
        <span class="text-sm text-gray-600 dark:text-gray-400">Water</span>
        <span class="text-sm font-bold text-blue-600">450 L</span>
      </div>
    </div>
  </div>
</div>

<!-- Meter Details -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
  <!-- Solar Meter -->
  <div
    class="bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-xl shadow-lg p-6 border border-yellow-200 dark:border-yellow-700"
  >
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center">
        <i class="fas fa-solar-panel text-2xl text-yellow-600 mr-3"></i>
        <h4 class="font-bold text-gray-900 dark:text-white">Solar Meter</h4>
      </div>
      <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full"
        >Online</span
      >
    </div>
    <div class="space-y-2 text-sm">
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Meter ID:</span>
        <span class="font-mono font-bold">SM-78432</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Type:</span>
        <span>E460 Smart</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Total Generated:</span>
        <span class="font-bold">3,245 kWh</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Free Remaining:</span>
        <span class="font-bold text-yellow-600">38 kWh</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Last Reading:</span>
        <span class="text-xs">2 min ago</span>
      </div>
    </div>
  </div>

  <!-- Electricity Meter -->
  <div
    class="bg-gradient-to-br from-red-50 to-pink-50 dark:from-red-900/20 dark:to-pink-900/20 rounded-xl shadow-lg p-6 border border-red-200 dark:border-red-700"
  >
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center">
        <i class="fas fa-bolt text-2xl text-red-600 mr-3"></i>
        <h4 class="font-bold text-gray-900 dark:text-white">
          Electricity Meter
        </h4>
      </div>
      <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full"
        >Online</span
      >
    </div>
    <div class="space-y-2 text-sm">
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Meter ID:</span>
        <span class="font-mono font-bold">EM-45621</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Type:</span>
        <span>E460 Prepaid</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Total Usage:</span>
        <span class="font-bold">8,432 kWh</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Supply Status:</span>
        <span class="font-bold text-green-600">Connected</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Last Reading:</span>
        <span class="text-xs">2 min ago</span>
      </div>
    </div>
  </div>

  <!-- Water Meter -->
  <div
    class="bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl shadow-lg p-6 border border-blue-200 dark:border-blue-700"
  >
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center">
        <i class="fas fa-tint text-2xl text-blue-600 mr-3"></i>
        <h4 class="font-bold text-gray-900 dark:text-white">Water Meter</h4>
      </div>
      <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full"
        >Online</span
      >
    </div>
    <div class="space-y-2 text-sm">
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Meter ID:</span>
        <span class="font-mono font-bold">WM-12987</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Type:</span>
        <span>DC450 Smart</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Total Usage:</span>
        <span class="font-bold">156,320 L</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Flow Status:</span>
        <span class="font-bold text-blue-600">Active</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600 dark:text-gray-400">Last Reading:</span>
        <span class="text-xs">2 min ago</span>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  // Simulate live updates
  setInterval(() => {
    // Update random consumption values
    const elecConsumption = (Math.random() * 3 + 1).toFixed(1);
    const solarGen = (Math.random() * 2 + 0.5).toFixed(1);
    const gridDraw = Math.max(0, elecConsumption - solarGen).toFixed(1);
    const waterFlow = (Math.random() * 20 + 5).toFixed(0);

    // You could update the DOM here with these values
  }, 5000);
</script>
{% endblock %}
