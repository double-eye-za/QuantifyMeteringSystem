{% extends "base.html" %}
{% block title %}Messages - Portal{% endblock %}
{% block page_title %}Messages{% endblock %}
{% block breadcrumb %}
<a href="{{ url_for('portal.portal_dashboard') }}" class="hover:text-primary">Home</a>
<span class="mx-2">/</span>
<span>Messages</span>
{% endblock %}

{% block content %}
<!-- Filter Tabs -->
<div class="flex items-center gap-4 mb-6">
  <a href="{{ url_for('portal.portal_messages') }}" class="px-4 py-2 text-sm rounded-lg {% if not filter_is_read %}bg-primary text-white{% else %}bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600{% endif %}">
    All
  </a>
  <a href="{{ url_for('portal.portal_messages', is_read='false') }}" class="px-4 py-2 text-sm rounded-lg {% if filter_is_read == 'false' %}bg-primary text-white{% else %}bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600{% endif %}">
    Unread {% if unread_count %}<span class="ml-1 px-2 py-0.5 text-xs bg-red-500 text-white rounded-full">{{ unread_count }}</span>{% endif %}
  </a>
  <a href="{{ url_for('portal.portal_messages', is_read='true') }}" class="px-4 py-2 text-sm rounded-lg {% if filter_is_read == 'true' %}bg-primary text-white{% else %}bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600{% endif %}">
    Read
  </a>
</div>

<!-- Message List -->
<div class="space-y-3">
  {% for recipient in recipients %}
  {% set msg = recipient.message %}
  <a href="{{ url_for('portal.portal_message_detail', message_id=msg.id) }}" class="block bg-white dark:bg-gray-800 rounded-lg shadow-sm border {% if not recipient.is_read %}border-blue-300 dark:border-blue-700{% else %}border-gray-200 dark:border-gray-700{% endif %} p-4 hover:shadow-md transition-shadow">
    <div class="flex items-start gap-3">
      {% if not recipient.is_read %}
      <div class="w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"></div>
      {% else %}
      <div class="w-2 h-2 rounded-full mt-2 flex-shrink-0"></div>
      {% endif %}
      <div class="flex-1 min-w-0">
        <div class="flex items-center justify-between">
          <h4 class="text-sm font-semibold text-gray-900 dark:text-white truncate">{{ msg.subject }}</h4>
          <span class="text-xs text-gray-500 dark:text-gray-400 flex-shrink-0 ml-4">{{ msg.created_at.strftime('%d %b %Y') if msg.created_at }}</span>
        </div>
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1 truncate">{{ msg.content[:100] if msg.content }}{{ '...' if msg.content and msg.content|length > 100 }}</p>
        <span class="text-xs text-gray-400 dark:text-gray-500 mt-1 inline-block">
          <i class="fas fa-{{ 'globe' if msg.message_type == 'broadcast' else 'building' if msg.message_type == 'estate' else 'user' }} mr-1"></i>
          {{ msg.message_type | capitalize if msg.message_type }}
        </span>
      </div>
    </div>
  </a>
  {% endfor %}
</div>

{% if not recipients %}
<div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-12 text-center">
  <i class="fas fa-envelope-open text-4xl text-gray-400 mb-4"></i>
  <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">No Messages</h3>
  <p class="text-gray-500 dark:text-gray-400">Your inbox is empty.</p>
</div>
{% endif %}
{% endblock %}
